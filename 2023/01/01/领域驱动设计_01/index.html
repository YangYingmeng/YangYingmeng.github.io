<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="一、领域驱动设计-理论篇" />
    <meta name="hexo-theme-A4" content="v1.9.7" />
    <link rel="alternate icon" type="image/webp" href="/img/avatar.png">
    <title>Ethan-逐道日记 | true</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--注意：首页既不是post也不是page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--返回顶部css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--目录-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


   
        
<link rel="stylesheet" href="/css/custom.css">

    

<meta name="generator" content="Hexo 7.3.0"></head>
    
    
        <style>
            .index-main{
                max-width:  1200px;
            }
        </style>

    
    



    

    
    




    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: '🌓', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    

    <div class="index-header-line" >
        <div id="hiddenHeaderContentArray" style="display: none;">
            
            
            
                <span>The only way to achieve the impossible is to believe it is possible.</span>
            
        </div>
        <span id="targetSpan"></span>
    </div>


<div class="header">
    <div class="header-container">
        <style>
            .header-img {
                width: 56px;
                height: auto;
                object-fit: cover; /* 保持图片比例 */
                transition: transform 0.3s ease-in-out; 
                border-radius: 0; 
            }
            
        </style>
        <img 
            alt="^-^" 
            cache-control="max-age=86400" 
            class="header-img" 
            src="/img/avatar.png" 
        />
        <div class="header-content">
            <a class="logo" href="/">Ethan-逐道日记</a> 
            <span class="description">逐有道无术之道</span> 
        </div>
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">首页</a></li>
            
        
            
                <li><a href="/list/">文章</a></li>
            
        
            
                <li><a href="/tags/">标签</a></li>
            
        
            
                <li><a href="/categories/">分类</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--说明是文章post页面-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    一、领域驱动设计-理论篇
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>最近更新：2025-02-27</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>字数总计：5.8k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>阅读估时：23分钟</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        阅读量：<span id="busuanzi_value_page_pv"></span>次
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
        
        <div class=".article-gallery"><h1 id="1-DDD-基础概念"><a href="#1-DDD-基础概念" class="headerlink" title="1. DDD 基础概念"></a>1. DDD 基础概念</h1><p>领域驱动设计（Domain-Driven Design, DDD）是由Eric Evans在其书《领域驱动设计》中提出的一种软件设计理念，旨在通过对业务领域的深入理解来构建复杂的业务系统。DDD强调将技术架构与业务需求紧密结合，从而有效地应对复杂性。</p>
<h2 id="1-1-领域（Domain）"><a href="#1-1-领域（Domain）" class="headerlink" title="1.1 领域（Domain）"></a>1.1 领域（Domain）</h2><p>领域是指系统所涉及的业务领域或问题空间。它描述了系统所服务的业务的各种事物和规则。理解领域是DDD的核心，因为只有深入了解业务领域，才能设计出符合实际需求的系统。</p>
<h3 id="领域的特点："><a href="#领域的特点：" class="headerlink" title="领域的特点："></a>领域的特点：</h3><ul>
<li><strong>业务问题</strong>：领域涉及的通常是实际的业务问题，比如金融、医疗、零售等。</li>
<li><strong>领域专家</strong>：领域专家是对领域有深刻理解的人，他们的经验和知识对于设计系统至关重要。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 商品领域</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String productId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> price;  <span class="comment">// 商品价格</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getProductId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单项领域</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderItem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Product product;  <span class="comment">// 商品</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> quantity;  <span class="comment">// 商品数量</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getTotalPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> product.getPrice() * quantity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">getProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getQuantity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> quantity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单领域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItem&gt; items;  <span class="comment">// 订单中的商品项</span></span><br><span class="line">    <span class="keyword">private</span> String status;  <span class="comment">// 订单状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> totalPrice;  <span class="comment">// 订单总价</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addItem</span><span class="params">(OrderItem item)</span> &#123;</span><br><span class="line">        items.add(item);</span><br><span class="line">        <span class="built_in">this</span>.totalPrice = calculateTotalPrice();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateTotalPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.stream().mapToDouble(OrderItem::getTotalPrice).sum();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;未支付&quot;</span>.equals(status)) &#123;</span><br><span class="line">            status = <span class="string">&quot;已支付&quot;</span>;  <span class="comment">// 支付操作</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;订单已支付或无效&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getTotalPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> totalPrice;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="1-2-子域（Subdomain）"><a href="#1-2-子域（Subdomain）" class="headerlink" title="1.2 子域（Subdomain）"></a>1.2 子域（Subdomain）</h2><p>一个大型的系统往往会涉及多个领域，子域是一个特定的领域的子集。每个子域都有自己的业务逻辑和规则，可以独立地开发和维护。</p>
<h3 id="子域的分类："><a href="#子域的分类：" class="headerlink" title="子域的分类："></a>子域的分类：</h3><ul>
<li><strong>核心子域（Core Subdomain）</strong>：对企业最为关键的领域，往往是系统的核心部分。</li>
<li><strong>支持子域（Supporting Subdomain）</strong>：为核心子域提供支持的领域。</li>
<li><strong>通用子域（Generic Subdomain）</strong>：适用于多个行业或企业的通用领域，往往可以用现成的解决方案。</li>
</ul>
<h2 id="1-3-模型（Model）"><a href="#1-3-模型（Model）" class="headerlink" title="1.3 模型（Model）"></a>1.3 模型（Model）</h2><p>模型是对业务领域的简化和抽象，它帮助开发者理解和描述领域的概念、业务流程和规则。在DDD中，模型不仅仅是技术上的设计图，还是和领域专家讨论业务逻辑的工具。</p>
<h3 id="模型的特点："><a href="#模型的特点：" class="headerlink" title="模型的特点："></a>模型的特点：</h3><ul>
<li><strong>Ubiquitous Language（通用语言）</strong>：模型中的所有术语和概念都应当与领域专家的语言一致，从而促进跨学科的沟通。</li>
<li><strong>表达业务</strong>：模型的目的是表达业务领域中的重要概念和行为。</li>
</ul>
<h2 id="1-4-聚合（Aggregate）"><a href="#1-4-聚合（Aggregate）" class="headerlink" title="1.4 聚合（Aggregate）"></a>1.4 聚合（Aggregate）</h2><p>聚合是一个由多个实体和值对象组成的集合，它在一个业务场景中表现为一个单元。聚合的设计目的是确保领域模型的一致性和完整性。</p>
<h3 id="聚合的特点："><a href="#聚合的特点：" class="headerlink" title="聚合的特点："></a>聚合的特点：</h3><ul>
<li><strong>根实体（Aggregate Root）</strong>：聚合中的一个实体，作为聚合的入口点。所有外部访问聚合的数据和操作都必须通过根实体。</li>
<li><strong>一致性边界</strong>：聚合内的对象必须保持一致性，聚合外的对象可以独立地发生变化。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItem&gt; items;</span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> totalPrice;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addItem</span><span class="params">(OrderItem item)</span> &#123;</span><br><span class="line">        items.add(item);</span><br><span class="line">        <span class="built_in">this</span>.totalPrice = calculateTotalPrice();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateTotalPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.stream().mapToDouble(OrderItem::getTotalPrice).sum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;未支付&quot;</span>.equals(status)) &#123;</span><br><span class="line">            status = <span class="string">&quot;已支付&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;订单已支付或无效&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;OrderItem&gt; <span class="title function_">getItems</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getTotalPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> totalPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>Order</code> 聚合根负责管理订单项（<code>OrderItem</code>）和订单的状态。</p>
<h2 id="1-5-实体（Entity）"><a href="#1-5-实体（Entity）" class="headerlink" title="1.5 实体（Entity）"></a>1.5 实体（Entity）</h2><p>实体是指在业务中有标识符且生命周期内可能发生变化的对象。实体通过唯一标识符来区分其他实体。</p>
<h3 id="实体的特点："><a href="#实体的特点：" class="headerlink" title="实体的特点："></a>实体的特点：</h3><ul>
<li><strong>标识符</strong>：实体必须有唯一标识符（ID），即使实体的属性发生变化，它依然保持唯一性。</li>
<li><strong>生命周期</strong>：实体通常有明确的生命周期，可能会被创建、修改或删除。</li>
</ul>
<h2 id="1-6-值对象（Value-Object）"><a href="#1-6-值对象（Value-Object）" class="headerlink" title="1.6 值对象（Value Object）"></a>1.6 值对象（Value Object）</h2><p>值对象是没有标识符、只通过属性定义的对象。在业务中，它通常用来表示某个不可变的概念。</p>
<h3 id="值对象的特点："><a href="#值对象的特点：" class="headerlink" title="值对象的特点："></a>值对象的特点：</h3><ul>
<li><strong>不可变性</strong>：一旦创建，值对象的状态就不能改变。任何变化都会生成一个新的值对象。</li>
<li><strong>无标识符</strong>：值对象通过其属性来唯一标识，而不是通过ID。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Money</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> amount;</span><br><span class="line">    <span class="keyword">private</span> String currency;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不可变的对象</span></span><br><span class="line">    <span class="keyword">public</span> Money <span class="title function_">add</span><span class="params">(Money other)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.currency.equals(other.currency)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Currency mismatch&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Money</span>(<span class="built_in">this</span>.amount + other.amount, <span class="built_in">this</span>.currency);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>Money</code> 是一个值对象，它表示金额的概念，可以用于订单价格的计算。</p>
<h2 id="1-7-领域服务（Domain-Service）"><a href="#1-7-领域服务（Domain-Service）" class="headerlink" title="1.7 领域服务（Domain Service）"></a>1.7 领域服务（Domain Service）</h2><p>领域服务是指执行一些不属于任何一个实体或值对象的操作的服务。领域服务通常用于处理复杂的业务逻辑，或者提供跨多个聚合的操作。</p>
<h3 id="领域服务的特点："><a href="#领域服务的特点：" class="headerlink" title="领域服务的特点："></a>领域服务的特点：</h3><ul>
<li><strong>无状态</strong>：领域服务通常没有自己的状态，它们通过输入和输出与领域模型进行交互。</li>
<li><strong>业务逻辑集中</strong>：领域服务负责封装跨多个聚合的复杂业务逻辑。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> OrderRepository orderRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderService</span><span class="params">(OrderRepository orderRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderRepository = orderRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">createOrder</span><span class="params">(String orderId, List&lt;OrderItem&gt; items)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>(orderId);</span><br><span class="line">        items.forEach(order::addItem);</span><br><span class="line">        orderRepository.save(order);</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">payOrder</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderRepository.findById(orderId);</span><br><span class="line">        order.pay();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>OrderService</code> 提供了业务逻辑，例如创建订单和支付订单。</p>
<h2 id="1-8-仓储（Repository）"><a href="#1-8-仓储（Repository）" class="headerlink" title="1.8 仓储（Repository）"></a>1.8 仓储（Repository）</h2><p>仓储是用于持久化和检索领域模型（如聚合根）的机制。它将领域模型与数据存储之间的映射抽象化，提供一个清晰的接口来访问领域对象。</p>
<h3 id="仓储的特点："><a href="#仓储的特点：" class="headerlink" title="仓储的特点："></a>仓储的特点：</h3><ul>
<li><strong>聚焦聚合根</strong>：仓储通常操作聚合根，其他对象通常不直接存储或访问。</li>
<li><strong>持久化操作</strong>：仓储通过持久化技术来存储和检索领域对象。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单仓储</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderRepository</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Order order)</span>;</span><br><span class="line">    Order <span class="title function_">findById</span><span class="params">(String orderId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InMemoryOrderRepository</span> <span class="keyword">implements</span> <span class="title class_">OrderRepository</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Order&gt; orderDatabase = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        orderDatabase.put(order.getOrderId(), order);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">findById</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderDatabase.get(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>InMemoryOrderRepository</code> 实现了 <code>OrderRepository</code> 接口，通过内存中的 <code>Map</code> 来存储和查找订单。</p>
<h2 id="1-9-领域事件（Domain-Event）"><a href="#1-9-领域事件（Domain-Event）" class="headerlink" title="1.9 领域事件（Domain Event）"></a>1.9 领域事件（Domain Event）</h2><p>领域事件是指在领域模型中发生的、对其他部分有意义的事件。它通常表示业务状态的改变。</p>
<h3 id="领域事件的特点："><a href="#领域事件的特点：" class="headerlink" title="领域事件的特点："></a>领域事件的特点：</h3><ul>
<li><strong>业务事件</strong>：领域事件描述了业务发生的某个重要事件，比如订单创建、支付完成等。</li>
<li><strong>异步处理</strong>：领域事件可以被其他系统或组件异步处理，通常与事件驱动架构结合使用。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单支付事件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderPaidEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderPaidEvent</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderId = orderId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getOrderId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>OrderPaidEvent</code> 表示一个订单支付成功的事件，可以通过事件发布机制进行通知。</p>
<h2 id="1-10-防腐层（Anticorruption-Layer）"><a href="#1-10-防腐层（Anticorruption-Layer）" class="headerlink" title="1.10 防腐层（Anticorruption Layer）"></a>1.10 防腐层（Anticorruption Layer）</h2><p>防腐层是一种模式，用来保护领域模型免受外部系统（如遗留系统或第三方系统）影响。通过防腐层，外部系统的变化不会直接影响到系统内部的核心领域模型。</p>
<h3 id="防腐层的特点："><a href="#防腐层的特点：" class="headerlink" title="防腐层的特点："></a>防腐层的特点：</h3><ul>
<li><strong>接口适配</strong>：防腐层将外部系统的接口转换成领域模型能够理解的格式。</li>
<li><strong>数据转换</strong>：防腐层负责将外部系统的数据转换成领域模型所需的格式，避免外部系统对领域模型的直接影响。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对外提供支付功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExternalPaymentSystem</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">processPayment</span><span class="params">(String orderId, <span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟支付处理</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Processing payment for Order ID: &quot;</span> + orderId);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ExternalPaymentSystem externalPaymentSystem;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentAdapter</span><span class="params">(ExternalPaymentSystem externalPaymentSystem)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.externalPaymentSystem = externalPaymentSystem;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">makePayment</span><span class="params">(String orderId, <span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> externalPaymentSystem.processPayment(orderId, amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>PaymentAdapter</code> 是防腐层，它将外部支付系统的接口转换为我们系统可以理解和使用的方式。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>领域</strong>：订单、商品、支付等。</p>
<p><strong>聚合</strong>：订单是聚合根，管理商品项。</p>
<p><strong>实体</strong>：订单和订单项是实体，通过唯一标识符来区分。</p>
<p><strong>值对象</strong>：金额（Money）是不可变的值对象。</p>
<p><strong>领域服务</strong>：如订单服务（OrderService），封装业务逻辑。</p>
<p><strong>仓储</strong>：如订单仓储（OrderRepository），用于持久化。</p>
<p><strong>领域事件</strong>：如订单支付事件。</p>
<p><strong>防腐层</strong>：用于隔离外部系统。</p>
<h1 id="2-DDD-设计原则"><a href="#2-DDD-设计原则" class="headerlink" title="2. DDD 设计原则"></a>2. DDD 设计原则</h1><h2 id="2-1-领域驱动设计的核心是聚焦业务"><a href="#2-1-领域驱动设计的核心是聚焦业务" class="headerlink" title="2.1 领域驱动设计的核心是聚焦业务"></a>2.1 领域驱动设计的核心是<strong>聚焦业务</strong></h2><p>DDD 的设计原则之一就是要聚焦业务，理解领域和业务需求。在系统设计时，要始终将关注点放在业务上，确保系统能够表达和解决实际的业务问题。</p>
<h3 id="示例：业务驱动设计"><a href="#示例：业务驱动设计" class="headerlink" title="示例：业务驱动设计"></a>示例：业务驱动设计</h3><p>假设我们正在设计一个电商系统中的订单服务。在这个服务中，我们的核心关注点就是“如何管理订单”。我们通过聚焦业务，创建了订单（Order）这一核心聚合对象。订单聚合包含多个订单项（OrderItem），每个订单项包含一个商品（Product）。这些领域对象和业务行为共同帮助我们实现电商平台的订单管理功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItem&gt; items;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> totalPrice;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addItem</span><span class="params">(OrderItem item)</span> &#123;</span><br><span class="line">        items.add(item);</span><br><span class="line">        <span class="built_in">this</span>.totalPrice = calculateTotalPrice();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateTotalPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.stream().mapToDouble(OrderItem::getTotalPrice).sum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getTotalPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> totalPrice;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个代码中，<code>Order</code> 这个聚合根关注的就是如何管理商品项和计算订单总价。业务需求是我们聚焦的核心。</p>
<h2 id="2-2-聚合设计原则：确保一致性和封装"><a href="#2-2-聚合设计原则：确保一致性和封装" class="headerlink" title="2.2 聚合设计原则：确保一致性和封装"></a>2.2 <strong>聚合设计原则：确保一致性和封装</strong></h2><p>聚合是 DDD 中的重要概念，它代表了一组领域对象，它们必须通过聚合根来访问。聚合的设计要确保一致性，即在同一个聚合内进行的操作应该是原子性的。聚合的封装性也非常重要，聚合外的代码不能直接修改聚合内部的状态。</p>
<h3 id="示例：订单聚合的设计"><a href="#示例：订单聚合的设计" class="headerlink" title="示例：订单聚合的设计"></a>示例：订单聚合的设计</h3><p>我们继续使用订单例子来解释聚合设计。<code>Order</code> 是一个聚合根，它管理 <code>OrderItem</code> 的集合。外部无法直接修改 <code>OrderItem</code>，只能通过 <code>Order</code> 聚合根提供的接口进行操作。这保证了聚合内的一致性和封装性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItem&gt; items;</span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 聚合根方法，不能直接操作 OrderItem</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addItem</span><span class="params">(OrderItem item)</span> &#123;</span><br><span class="line">        items.add(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;未支付&quot;</span>.equals(status)) &#123;</span><br><span class="line">            status = <span class="string">&quot;已支付&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;订单已支付&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;OrderItem&gt; <span class="title function_">getItems</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里，<code>Order</code> 是聚合根，它封装了所有与订单相关的操作。外部不能直接操作 <code>OrderItem</code>，只能通过 <code>Order</code> 来添加商品项，支付订单等。这确保了聚合内的一致性。</p>
<h2 id="2-3-限界上下文（Bounded-Context）原则"><a href="#2-3-限界上下文（Bounded-Context）原则" class="headerlink" title="2.3 限界上下文（Bounded Context）原则"></a>2.3 <strong>限界上下文（Bounded Context）原则</strong></h2><p>限界上下文是 DDD 中的关键概念，它定义了系统中不同部分的边界和业务模型。每个限界上下文都有自己独立的业务模型，这些模型之间的交互通过明确定义的接口进行。限界上下文原则强调不同模块之间的隔离和解耦。</p>
<h3 id="示例：限界上下文"><a href="#示例：限界上下文" class="headerlink" title="示例：限界上下文"></a>示例：限界上下文</h3><p>在电商系统中，订单模块、支付模块和库存模块可能是不同的限界上下文。每个限界上下文有自己独立的业务逻辑，且它们之间的交互要通过接口或事件来完成。例如，支付模块不直接操作订单模块的数据，而是通过发送支付成功事件或调用订单模块提供的接口来更新订单状态。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支付模块中的支付成功事件</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentSucceededEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentSucceededEvent</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderId = orderId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getOrderId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单模块处理支付成功事件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlePaymentSucceeded</span><span class="params">(PaymentSucceededEvent event)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderRepository.findById(event.getOrderId());</span><br><span class="line">        order.pay();</span><br><span class="line">        orderRepository.save(order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里，<code>PaymentSucceededEvent</code> 表示支付成功的事件，订单模块通过订阅这个事件来更新订单状态。不同的限界上下文通过事件解耦，确保了系统的模块化和高内聚低耦合。</p>
<h2 id="2-4-领域事件（Domain-Events）设计原则"><a href="#2-4-领域事件（Domain-Events）设计原则" class="headerlink" title="2.4 领域事件（Domain Events）设计原则"></a>2.4 <strong>领域事件（Domain Events）设计原则</strong></h2><p>领域事件用于表示一个重要的业务事件，它在业务领域内传播，可能会触发其他业务操作。领域事件设计原则强调了事件驱动模型的使用，它帮助我们解耦不同模块之间的交互，使得系统更加灵活和扩展性更强。</p>
<h3 id="示例：领域事件"><a href="#示例：领域事件" class="headerlink" title="示例：领域事件"></a>示例：领域事件</h3><p>继续用订单系统来演示领域事件。假设在支付成功后，我们需要通知库存系统减少库存数量，这时我们可以使用领域事件来完成。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单支付成功领域事件</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderPaidEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderPaidEvent</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderId = orderId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getOrderId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 领域事件处理器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleOrderPaid</span><span class="params">(OrderPaidEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 在支付成功后，更新库存</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Order &quot;</span> + event.getOrderId() + <span class="string">&quot; paid. Reducing inventory.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>OrderPaidEvent</code> 表示订单支付成功的事件，<code>InventoryService</code> 处理这个事件来减少库存。通过领域事件的设计，支付和库存操作解耦，系统更加灵活。</p>
<h2 id="2-5-防腐层（Anticorruption-Layer）原则"><a href="#2-5-防腐层（Anticorruption-Layer）原则" class="headerlink" title="2.5 防腐层（Anticorruption Layer）原则"></a>2.5 <strong>防腐层（Anticorruption Layer）原则</strong></h2><p>防腐层用于保护我们领域模型不受外部系统变化的影响。它充当了领域模型和外部系统之间的隔离层，防止外部系统的变化直接影响我们的领域模型。</p>
<h3 id="示例：防腐层"><a href="#示例：防腐层" class="headerlink" title="示例：防腐层"></a>示例：防腐层</h3><p>假设我们有一个外部支付系统，我们可以使用防腐层来适配外部支付系统的接口，使其与我们的领域模型兼容。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 外部支付系统</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExternalPaymentSystem</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">processPayment</span><span class="params">(String orderId, <span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟支付处理</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Processing payment for Order ID: &quot;</span> + orderId);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 防腐层，适配外部支付系统</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ExternalPaymentSystem externalPaymentSystem;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentAdapter</span><span class="params">(ExternalPaymentSystem externalPaymentSystem)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.externalPaymentSystem = externalPaymentSystem;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">makePayment</span><span class="params">(String orderId, <span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> externalPaymentSystem.processPayment(orderId, amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>PaymentAdapter</code> 是防腐层，它将外部支付系统的接口适配到我们系统可以理解和使用的方式。这保证了外部系统的变化不会直接影响我们的领域模型。</p>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>DDD 设计原则为我们提供了如何组织和管理复杂业务的框架，确保系统在面对变化时仍能保持灵活性和扩展性。通过以下原则，我们能够构建出更具高内聚低耦合的系统：</p>
<ul>
<li><strong>聚焦业务</strong>：始终关注业务需求，设计符合业务的模型。</li>
<li><strong>聚合设计原则</strong>：确保聚合内的一致性和封装性。</li>
<li><strong>限界上下文</strong>：明确系统的不同模块和边界，避免跨模块的业务逻辑混乱。</li>
<li><strong>领域事件</strong>：使用事件驱动模型解耦系统模块，提高扩展性。</li>
<li><strong>防腐层</strong>：保护领域模型不受外部系统变化的影响。</li>
</ul>
<p>这些设计原则将帮助我们在开发过程中保持业务与技术的高度一致，让系统随着业务需求的变化能够灵活扩展。</p>
<h1 id="3-实现-DDD-的架构"><a href="#3-实现-DDD-的架构" class="headerlink" title="3. 实现 DDD 的架构"></a>3. 实现 DDD 的架构</h1><h2 id="1-DDD架构：单体应用实现"><a href="#1-DDD架构：单体应用实现" class="headerlink" title="1. DDD架构：单体应用实现"></a>1. <strong>DDD架构：单体应用实现</strong></h2><p>在单体应用中，虽然所有的业务逻辑、数据和服务都运行在同一个进程和数据库中，但依然可以遵循 DDD 的设计原则，利用 <strong>领域模型</strong> 来组织代码，并通过 <strong>模块化</strong> 来划分业务领域。</p>
<h3 id="1-1-核心领域模型"><a href="#1-1-核心领域模型" class="headerlink" title="1.1. 核心领域模型"></a>1.1. <strong>核心领域模型</strong></h3><p>在单体应用中，DDD 的核心概念（如实体、值对象、聚合根、领域服务等）依然适用。你可以将系统的不同业务领域抽象为独立的 <strong>领域模型</strong>，并确保每个模块专注于自己的业务功能。</p>
<p><strong>举个例子</strong>，假设我们在构建一个电商系统，其中涉及订单、支付、库存和物流等多个业务领域。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单领域模型（Order Domain）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String customerId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItem&gt; items;</span><br><span class="line">    <span class="keyword">private</span> OrderStatus status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addItem</span><span class="params">(OrderItem item)</span> &#123;</span><br><span class="line">        <span class="comment">// 业务逻辑：添加商品到订单</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeStatus</span><span class="params">(OrderStatus newStatus)</span> &#123;</span><br><span class="line">        <span class="comment">// 业务逻辑：修改订单状态</span></span><br><span class="line">        <span class="built_in">this</span>.status = newStatus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 其他领域方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderItem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String productId;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> quantity;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 其他领域方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-2-模块化设计"><a href="#1-2-模块化设计" class="headerlink" title="1.2. 模块化设计"></a>1.2. <strong>模块化设计</strong></h3><p>在单体应用中，你可以通过 <strong>模块</strong> 来划分领域。每个模块对应系统中的一个领域，模块内部可以有实体、聚合根、值对象、领域服务等，而模块之间通过接口和领域事件进行交互。</p>
<ul>
<li><strong>订单模块（Order Module）</strong>：包含订单相关的所有实体、聚合根和领域服务。</li>
<li><strong>支付模块（Payment Module）</strong>：处理支付相关的业务逻辑。</li>
<li><strong>库存模块（Inventory Module）</strong>：管理商品库存。</li>
<li><strong>物流模块（Logistics Module）</strong>：处理物流配送。</li>
</ul>
<p><strong>模块划分</strong>有助于代码的清晰性和可维护性。在 Spring 框架中，模块可以通过包结构、接口层、服务层等方式实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单服务（Order Service）</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderRepository orderRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderService</span><span class="params">(OrderRepository orderRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderRepository = orderRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        orderRepository.save(order);  <span class="comment">// 订单保存到数据库</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateOrderStatus</span><span class="params">(String orderId, OrderStatus status)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderRepository.findById(orderId);</span><br><span class="line">        order.changeStatus(status);</span><br><span class="line">        orderRepository.save(order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-领域事件与防腐层"><a href="#1-3-领域事件与防腐层" class="headerlink" title="1.3. 领域事件与防腐层"></a>1.3. <strong>领域事件与防腐层</strong></h3><p>即使在单体应用中，领域事件和防腐层的概念也非常重要。如果不同模块之间需要通过事件进行通信，或者某个模块需要调用外部系统，我们依然可以使用领域事件和防腐层。</p>
<p>例如，<strong>库存模块</strong>可能需要在订单成功支付后减少库存，这时可以通过领域事件来解耦订单服务与库存服务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单支付成功后发布领域事件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderPaidEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line">    <span class="keyword">private</span> String customerId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数、getter、setter等</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ApplicationEventPublisher eventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderService</span><span class="params">(ApplicationEventPublisher eventPublisher)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.eventPublisher = eventPublisher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">payOrder</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 支付成功，发布领域事件</span></span><br><span class="line">        eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">OrderPaidEvent</span>(orderId, <span class="string">&quot;customer123&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 库存服务监听订单支付成功事件</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryService</span> &#123;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleOrderPaidEvent</span><span class="params">(OrderPaidEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理库存减少的业务逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-4-单体应用中的防腐层"><a href="#1-4-单体应用中的防腐层" class="headerlink" title="1.4. 单体应用中的防腐层"></a>1.4. <strong>单体应用中的防腐层</strong></h3><p>如果你的单体应用需要与外部系统集成，防腐层依然可以用来隔离外部服务的实现细节，确保你内部的领域模型不受外部服务影响。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExternalPaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> PaymentResponse <span class="title function_">makePayment</span><span class="params">(PaymentRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用外部支付服务</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaymentResponse</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentFacade</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExternalPaymentService externalPaymentService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentFacade</span><span class="params">(ExternalPaymentService externalPaymentService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.externalPaymentService = externalPaymentService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PaymentResponse <span class="title function_">processPayment</span><span class="params">(PaymentRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 防腐层：转换请求数据并调用外部支付服务</span></span><br><span class="line">        <span class="keyword">return</span> externalPaymentService.makePayment(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-DDD架构：微服务实现"><a href="#2-DDD架构：微服务实现" class="headerlink" title="2. DDD架构：微服务实现"></a>2. <strong>DDD架构：微服务实现</strong></h2><p>在微服务架构中，DDD 的设计理念依然适用，只不过由于微服务本身是 <strong>分布式</strong> 的，我们需要更加关注服务间的通信、数据一致性和领域解耦等问题。</p>
<h3 id="2-1-微服务中的领域（服务）"><a href="#2-1-微服务中的领域（服务）" class="headerlink" title="2.1. 微服务中的领域（服务）"></a>2.1. <strong>微服务中的领域（服务）</strong></h3><p>在微服务架构中，每个 <strong>领域</strong> 对应一个独立的 <strong>微服务</strong>。每个微服务聚焦于自己的业务领域，拥有自己的数据存储、API 和业务逻辑。微服务之间通常通过 REST、GraphQL、gRPC 或消息队列等方式进行通信。</p>
<p>例如，订单、支付、库存等每个模块都可以是一个独立的微服务：</p>
<ul>
<li><strong>订单微服务（Order Service）</strong>：处理与订单相关的所有操作。</li>
<li><strong>支付微服务（Payment Service）</strong>：专注于支付逻辑。</li>
<li><strong>库存微服务（Inventory Service）</strong>：负责库存管理。</li>
</ul>
<p>每个微服务都根据 <strong>DDD</strong> 的设计原则，围绕各自的领域来构建。</p>
<h3 id="2-2-微服务间的通信与防腐层"><a href="#2-2-微服务间的通信与防腐层" class="headerlink" title="2.2. 微服务间的通信与防腐层"></a>2.2. <strong>微服务间的通信与防腐层</strong></h3><p>在微服务架构中，防腐层尤为重要。因为服务间的通信往往会涉及到数据的转换、协议的适配以及接口的规范等，防腐层可以帮助微服务之间保持独立性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 库存微服务通过 REST API 与订单微服务通信</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">InventoryService</span><span class="params">(RestTemplate restTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.restTemplate = restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> InventoryResponse <span class="title function_">checkInventory</span><span class="params">(String productId)</span> &#123;</span><br><span class="line">        <span class="comment">// 防腐层：调用外部订单微服务</span></span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(<span class="string">&quot;http://order-service/checkInventory/&quot;</span> + productId, InventoryResponse.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-3-跨微服务的领域事件"><a href="#2-3-跨微服务的领域事件" class="headerlink" title="2.3. 跨微服务的领域事件"></a>2.3. <strong>跨微服务的领域事件</strong></h3><p>在微服务架构中，<strong>领域事件</strong> 是解耦微服务之间的重要手段。当一个微服务的领域模型发生变化时，它会发布领域事件，其他微服务可以订阅这些事件并做出响应。通过这种方式，微服务之间可以在不直接依赖的情况下协同工作。</p>
<p>举个例子，<strong>订单微服务</strong> 在订单支付成功后发布 <code>OrderPaidEvent</code>，<strong>库存微服务</strong> 订阅这个事件并更新库存。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单微服务发布领域事件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderPaidEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数、getter、setter等</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 库存微服务订阅领域事件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryService</span> &#123;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleOrderPaidEvent</span><span class="params">(OrderPaidEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 更新库存</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-4-业务聚合层（BP层）"><a href="#2-4-业务聚合层（BP层）" class="headerlink" title="2.4. 业务聚合层（BP层）"></a>2.4. <strong>业务聚合层（BP层）</strong></h3><p>在微服务架构中，业务聚合层（BP层）常常作为 <strong>API 网关</strong> 或 <strong>业务协调层</strong>，它负责从多个微服务中获取数据并进行聚合，然后返回给前端。BP层避免了前端直接调用多个微服务的多个 API，提升了性能和用户体验。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderBPService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderService orderService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PaymentService paymentService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InventoryService inventoryService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderBPService</span><span class="params">(OrderService orderService, PaymentService paymentService, InventoryService inventoryService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderService = orderService;</span><br><span class="line">        <span class="built_in">this</span>.paymentService = paymentService;</span><br><span class="line">        <span class="built_in">this</span>.inventoryService = inventoryService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> OrderDetailsDTO <span class="title function_">getOrderDetails</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用多个微服务并聚合数据</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.getOrder(orderId);</span><br><span class="line">        <span class="type">PaymentStatus</span> <span class="variable">paymentStatus</span> <span class="operator">=</span> paymentService.getPaymentStatus(orderId);</span><br><span class="line">        <span class="type">InventoryStatus</span> <span class="variable">inventoryStatus</span> <span class="operator">=</span> inventoryService.getInventoryStatus(order.getProductId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderDetailsDTO</span>(order, paymentStatus, inventoryStatus);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-5-微服务中的防腐层"><a href="#2-5-微服务中的防腐层" class="headerlink" title="2.5. 微服务中的防腐层"></a>2.5. <strong>微服务中的防腐层</strong></h3><p>在微服务架构中，防腐层通常表现为 <strong>服务间的适配层</strong>，它可以负责处理不同微服务之间的通信协议、数据格式的转换等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceFacade</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InventoryService inventoryService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderServiceFacade</span><span class="params">(InventoryService inventoryService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.inventoryService = inventoryService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span></span><br></pre></td></tr></table></figure>

</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-01-01</span>
            
                <span>该篇文章被 Ethan</span>
            
            
                <span>打上标签:
                    
                    
                        <a href='/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%EF%BC%88DDD%EF%BC%89/'>
                            领域驱动设计（DDD）
                        </a>
                    
                </span>
             
             
                <span>归为分类:
                    
                    
                        <a href='/categories/%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95%E8%AE%BA/'>
                            设计方法论
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                

                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            © 1949-2025 China 

            
                

            
                
                    / <a href="/contact/"> 联系 </a>
                

            
                
                    / <a href="/support/"> 支持 </a>
                

            
        </span>
       
    
</div>



<!--这是指一条线往下的内容-->
<div class="footer-last">
    
            <span>✨&#34;The only way to achieve the impossible is to believe it is possible.&#34; ✨</span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--目录-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--回到顶部按钮-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // 启用插件
            thumbnail: true,          // 显示缩略图
            zoom: true,               // 启用缩放功
            rotate: true,             // 启用旋转功能能
            autoplay: true,        // 启用自动播放功能
            fullScreen: true,      // 启用全屏功能
            pager: false, //页码,
            zoomFromOrigin: true,   // 从原始位置缩放
            actualSize: true,       // 启用查看实际大小的功能
            enableZoomAfter: 300,    // 延迟缩放，确保图片加载完成后可缩放
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // 修复选择器
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- 回到顶部的按钮-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- 返回的按钮-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>