<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="ä¸€ã€Javaå¹¶å‘ç¼–ç¨‹-çº¿ç¨‹åŸºç¡€" />
    <meta name="hexo-theme-A4" content="v1.9.7" />
    <link rel="alternate icon" type="image/webp" href="/img/avatar.png">
    <title>Ethan-é€é“æ—¥è®° | true</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


   
        
<link rel="stylesheet" href="/css/custom.css">

    

<meta name="generator" content="Hexo 7.3.0"></head>
    
    
        <style>
            .index-main{
                max-width:  1200px;
            }
        </style>

    
    



    

    
    




    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    

    <div class="index-header-line" >
        <div id="hiddenHeaderContentArray" style="display: none;">
            
            
            
                <span>Your only limit is your mind.</span>
            
        </div>
        <span id="targetSpan"></span>
    </div>


<div class="header">
    <div class="header-container">
        <style>
            .header-img {
                width: 56px;
                height: auto;
                object-fit: cover; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
                transition: transform 0.3s ease-in-out; 
                border-radius: 0; 
            }
            
        </style>
        <img 
            alt="^-^" 
            cache-control="max-age=86400" 
            class="header-img" 
            src="/img/avatar.png" 
        />
        <div class="header-content">
            <a class="logo" href="/">Ethan-é€é“æ—¥è®°</a> 
            <span class="description">é€æœ‰é“æ— æœ¯ä¹‹é“</span> 
        </div>
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/tags/">æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    ä¸€ã€Javaå¹¶å‘ç¼–ç¨‹-çº¿ç¨‹åŸºç¡€
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>æœ€è¿‘æ›´æ–°ï¼š2025-03-20</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>å­—æ•°æ€»è®¡ï¼š5.7k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š24åˆ†é’Ÿ</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
        
        <div class=".article-gallery"><h1 id="Javaå¹¶å‘ç¼–ç¨‹-çº¿ç¨‹åŸºç¡€"><a href="#Javaå¹¶å‘ç¼–ç¨‹-çº¿ç¨‹åŸºç¡€" class="headerlink" title="Javaå¹¶å‘ç¼–ç¨‹-çº¿ç¨‹åŸºç¡€"></a>Javaå¹¶å‘ç¼–ç¨‹-çº¿ç¨‹åŸºç¡€</h1><h2 id="1-ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ"></a><strong>1. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ</strong></h2><p>åœ¨ Java å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œ<strong>çº¿ç¨‹</strong>å’Œ<strong>è¿›ç¨‹</strong>æ˜¯æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒä»¬å†³å®šäº†ç¨‹åºçš„æ‰§è¡Œæ–¹å¼ï¼š</p>
<ul>
<li><strong>è¿›ç¨‹ï¼ˆProcessï¼‰</strong>ï¼šç¨‹åºåœ¨æ“ä½œç³»ç»Ÿä¸­çš„ä¸€æ¬¡æ‰§è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´å’Œç³»ç»Ÿèµ„æºã€‚</li>
<li><strong>çº¿ç¨‹ï¼ˆThreadï¼‰</strong>ï¼šçº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œè·¯å¾„ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘åŒ…å«ä¸€ä¸ªçº¿ç¨‹ã€‚<strong>å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æº</strong>ï¼Œä½†æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„è¿è¡Œç¯å¢ƒã€‚</li>
</ul>
<blockquote>
<p>æ“ä½œç³»ç»Ÿåœ¨åˆ†é…èµ„æºæ—¶ï¼Œä¼šå°†èµ„æºåˆ†é…ç»™<strong>è¿›ç¨‹</strong>ï¼Œè€Œ <strong>CPU èµ„æºæ˜¯ç›´æ¥åˆ†é…ç»™çº¿ç¨‹çš„</strong>ï¼Œå› æ­¤ <strong>çº¿ç¨‹æ‰æ˜¯ CPU èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½</strong>ã€‚</p>
</blockquote>
<p>åœ¨ Java ä¸­ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ <code>main</code> æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯å¯åŠ¨äº†ä¸€ä¸ª <strong>JVM è¿›ç¨‹</strong>ï¼Œå…¶ä¸­ <code>main</code> æ–¹æ³•æ‰€åœ¨çš„çº¿ç¨‹è¢«ç§°ä¸º<strong>ä¸»çº¿ç¨‹ï¼ˆMain Threadï¼‰</strong>ã€‚</p>
<h2 id="2-è¿›ç¨‹ä¸çº¿ç¨‹çš„å†…å­˜ç»“æ„"><a href="#2-è¿›ç¨‹ä¸çº¿ç¨‹çš„å†…å­˜ç»“æ„" class="headerlink" title="2. è¿›ç¨‹ä¸çº¿ç¨‹çš„å†…å­˜ç»“æ„"></a>2. è¿›ç¨‹ä¸çº¿ç¨‹çš„å†…å­˜ç»“æ„</h2><p><a href="/../img/juc/01.jpg" class="gallery-item" style="box-shadow: none;"> <img src="/../img/juc/01.jpg"></a></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”çº¿ç¨‹ä¹‹é—´å…±äº«è¿›ç¨‹çš„éƒ¨åˆ†å†…å­˜ç»“æ„ï¼š</p>
<table>
<thead>
<tr>
<th><strong>å†…å­˜åŒºåŸŸ</strong></th>
<th><strong>ä½œç”¨</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPC Registerï¼‰</strong></td>
<td>è®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œæ–¹ä¾¿ CPU çº¿ç¨‹åˆ‡æ¢æ—¶æ¢å¤æ‰§è¡ŒçŠ¶æ€ã€‚</td>
</tr>
<tr>
<td><strong>æ ˆï¼ˆStackï¼‰</strong></td>
<td>å­˜å‚¨çº¿ç¨‹çš„å±€éƒ¨å˜é‡ã€æ–¹æ³•è°ƒç”¨æ ˆå¸§ï¼ˆFrameï¼‰ï¼Œæ˜¯çº¿ç¨‹<strong>ç§æœ‰</strong>çš„ã€‚</td>
</tr>
<tr>
<td><strong>å †ï¼ˆHeapï¼‰</strong></td>
<td>è¿›ç¨‹åˆ›å»ºæ—¶åˆ†é…ï¼Œä¸»è¦å­˜æ”¾ <code>new</code> åˆ›å»ºçš„å¯¹è±¡å®ä¾‹ï¼Œ<strong>æ‰€æœ‰çº¿ç¨‹å…±äº«</strong>ã€‚</td>
</tr>
<tr>
<td><strong>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</strong></td>
<td>å­˜å‚¨ JVM åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰ï¼Œ<strong>æ‰€æœ‰çº¿ç¨‹å…±äº«</strong>ã€‚</td>
</tr>
</tbody></table>
<p>è¿™äº›å†…å­˜åŒºåŸŸçš„åˆ’åˆ†æœ‰åŠ©äº JVM å®ç°é«˜æ•ˆçš„å¹¶å‘ç®¡ç†ï¼ŒåŒæ—¶é¿å…çº¿ç¨‹ä¹‹é—´çš„ä¸å¿…è¦å¹²æ‰°ã€‚</p>
<h2 id="3-çº¿ç¨‹çš„åŸºç¡€API"><a href="#3-çº¿ç¨‹çš„åŸºç¡€API" class="headerlink" title="3. çº¿ç¨‹çš„åŸºç¡€API"></a>3. çº¿ç¨‹çš„åŸºç¡€API</h2><h3 id="3-1-åˆ›å»ºä¸è¿è¡Œ"><a href="#3-1-åˆ›å»ºä¸è¿è¡Œ" class="headerlink" title="3.1 åˆ›å»ºä¸è¿è¡Œ"></a>3.1 åˆ›å»ºä¸è¿è¡Œ</h3><p>åœ¨ Java ä¸­ï¼Œåˆ›å»ºçº¿ç¨‹ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼š</p>
<ol>
<li><p>ç»§æ‰¿ <code>Thread</code> ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">_01CreatThread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">extendThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;é€šè¿‡ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">extendThread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">extendThread</span>();</span><br><span class="line">        <span class="comment">// è°ƒç”¨startå, çº¿ç¨‹è¿›å…¥å°±ç»ªæ€, ç­‰å¾…cpuè°ƒåº¦</span></span><br><span class="line">        t1.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®ç° <code>Runnable</code> æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">_01CreatThread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">implementRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;é€šè¿‡å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">         <span class="type">implementRunnable</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">implementRunnable</span>();</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">Thread</span>(task).start();</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">Thread</span>(task).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®ç° <code>Callable</code> æ¥å£ï¼ˆç»“åˆ <code>FutureTask</code> è·å–è¿”å›å€¼ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">_01CreatThread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">implementCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;é€šè¿‡å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">         FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">implementCallable</span>());</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask).start();</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> futureTask.get();</span><br><span class="line">              System.out.println(result);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>æ€»ç»“å¯¹æ¯”</strong></p>
<table>
<thead>
<tr>
<th>æ–¹å¼</th>
<th>ä¼˜åŠ¿</th>
<th>åŠ£åŠ¿</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç»§æ‰¿ <code>Thread</code></strong></td>
<td>ç»“æ„æ¸…æ™°ï¼Œé€‚åˆç®€å•çš„çº¿ç¨‹ä»»åŠ¡</td>
<td>å—é™äº Java <strong>å•ç»§æ‰¿</strong>ï¼Œæ— æ³•ç»§æ‰¿å…¶ä»–ç±»</td>
</tr>
<tr>
<td><strong>å®ç° <code>Runnable</code></strong></td>
<td><strong>é¿å…å•ç»§æ‰¿é™åˆ¶</strong>ï¼Œå¯ä»¥å…±äº«åŒä¸€ä¸ªä»»åŠ¡å¯¹è±¡</td>
<td>æ— æ³•è·å–çº¿ç¨‹çš„æ‰§è¡Œç»“æœ</td>
</tr>
<tr>
<td><strong>å®ç° <code>Callable</code></strong></td>
<td><strong>å¯ä»¥è¿”å›æ‰§è¡Œç»“æœ</strong>ï¼Œæ”¯æŒå¼‚å¸¸å¤„ç†</td>
<td>éœ€è¦ <code>FutureTask</code>ï¼Œä½¿ç”¨ç¨å¾®å¤æ‚</td>
</tr>
</tbody></table>
<h3 id="3-2-é€šçŸ¥ä¸ç­‰å¾…wait-notify"><a href="#3-2-é€šçŸ¥ä¸ç­‰å¾…wait-notify" class="headerlink" title="3.2 é€šçŸ¥ä¸ç­‰å¾…wait()&amp;notify()"></a>3.2 é€šçŸ¥ä¸ç­‰å¾…wait()&amp;notify()</h3><p>æ¯ä¸ª Java å¯¹è±¡éƒ½å†…ç½®äº†ç›‘è§†å™¨é”ï¼Œ<code>wait()</code> å’Œ <code>notify()</code> ä¾èµ–ç›‘è§†å™¨é”æ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Œå› æ­¤å®ƒä»¬æ˜¯ <code>Object</code> ç±»çš„æ–¹æ³•ã€‚</p>
<h4 id="3-2-1-wait-æ–¹æ³•"><a href="#3-2-1-wait-æ–¹æ³•" class="headerlink" title="3.2.1 wait() æ–¹æ³•"></a>3.2.1 <code>wait()</code> æ–¹æ³•</h4><p>å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å…±äº«å¯¹è±¡çš„ <code>wait()</code> æ–¹æ³•æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šè¿›å…¥ <strong>ç­‰å¾…çŠ¶æ€</strong>ï¼ˆBlockedï¼‰ã€‚</p>
<ol>
<li><p><strong>çº¿ç¨‹çš„å”¤é†’æ–¹å¼ï¼š</strong></p>
<ol>
<li><p><strong>å…¶å®ƒçº¿ç¨‹è°ƒç”¨ <code>notify()</code> æˆ– <code>notifyAll()</code></strong> è®©ç­‰å¾…çš„çº¿ç¨‹æ¢å¤è¿è¡Œã€‚</p>
</li>
<li><p><strong>å…¶å®ƒçº¿ç¨‹è°ƒç”¨ <code>interrupt()</code></strong> æ–¹æ³•ä¸­æ–­è¯¥çº¿ç¨‹ã€‚</p>
</li>
</ol>
<p>çº¿ç¨‹åœ¨è°ƒç”¨ <code>wait()</code> æ–¹æ³•æ—¶ï¼Œå¿…é¡»å…ˆ <strong>è·å–è¯¥å¯¹è±¡çš„ç›‘è§†å™¨é”</strong>ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>IllegalMonitorStateException</code>ã€‚</p>
</li>
<li><p><strong>è·å–å…±äº«å˜é‡çš„ç›‘è§†å™¨é”çš„æ–¹å¼</strong></p>
<ol>
<li><p>åœ¨ <code>synchronized</code> ä»£ç å—ä¸­ï¼Œä½¿ç”¨è¯¥å…±äº«å˜é‡ä½œä¸ºé”ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (å…±äº«å˜é‡) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ <code>synchronized</code> æ–¹æ³•å†…éƒ¨è°ƒç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">add</span> <span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p><strong>è™šå‡å”¤é†’(Spurious Wakeup)</strong></p>
<p><strong>è™šå‡å”¤é†’</strong>ï¼šçº¿ç¨‹è¢« <strong>æ„å¤–</strong> å”¤é†’ï¼Œå¯¼è‡´é€»è¾‘é”™è¯¯ã€‚</p>
<blockquote>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<strong>ä½¿ç”¨ <code>while</code> è€Œä¸æ˜¯ <code>if</code> æ¥æ£€æŸ¥æ¡ä»¶</strong>ï¼Œé˜²æ­¢çº¿ç¨‹è¢«é”™è¯¯å”¤é†’åæ‰§è¡Œä¸ç¬¦åˆé¢„æœŸçš„æ“ä½œã€‚</p>
</blockquote>
</li>
<li><p><strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹(ç¤ºä¾‹ä»£ç )</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">producerConsumerTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å…±äº«é˜Ÿåˆ—, ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é€šè¿‡ synchronized æ‹¿åˆ°è¯¥å…±äº«å˜é‡çš„ç›‘è§†å™¨é”</span></span><br><span class="line">    List&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿäº§è€…</span></span><br><span class="line">    <span class="keyword">synchronized</span> (queue) &#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—æ»¡æ—¶ä¸å†ç”Ÿäº§, é€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹, é˜²æ­¢è™šå‡å”¤é†’</span></span><br><span class="line">        <span class="keyword">while</span> (queue.size() == <span class="number">5</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                queue.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç©ºé—²æ—¶ç”Ÿæˆå…ƒç´ , é€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line">        queue.add(<span class="number">1</span>);</span><br><span class="line">        queue.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¶ˆè´¹è€…</span></span><br><span class="line">    <span class="keyword">synchronized</span> (queue) &#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—ç©ºæ—¶ä¸å†æ¶ˆè´¹, é€šçŸ¥ç”Ÿäº§è€…ç”Ÿäº§, é˜²æ­¢è™šå‡å”¤é†’</span></span><br><span class="line">        <span class="keyword">while</span> (queue.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">                queue.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ æ—¶è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line">        queue.remove(queue.size() - <span class="number">1</span>);</span><br><span class="line">        queue.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>wait()åªèƒ½é‡Šæ”¾å½“å‰å…±äº«å˜é‡ä¸Šçš„é”</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•wait()åªé‡Šæ”¾å½“å‰å…±äº«å˜é‡çš„é”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">Object</span> <span class="variable">resourceA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">Object</span> <span class="variable">resourceB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">threadA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–Aå…±äº«èµ„æºçš„ç›‘è§†å™¨é”</span></span><br><span class="line">            <span class="keyword">synchronized</span> (resourceA) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;threadA get resourceA lock&quot;</span>);</span><br><span class="line">                <span class="comment">// è·å–Bå…±äº«èµ„æºçš„ç›‘è§†å™¨é”</span></span><br><span class="line">                <span class="keyword">synchronized</span> (resourceB) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;threadA get resourceB lock&quot;</span>);</span><br><span class="line">                    <span class="comment">// çº¿ç¨‹Aé˜»å¡, å¹¶é‡Šæ”¾è·å–åˆ°çš„resourceAé”</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;threadA release resourceA lock&quot;</span>);</span><br><span class="line">                    resourceA.wait();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">threadB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            <span class="comment">// è·å–resourceAå…±äº«èµ„æºç›‘è§†å™¨é”</span></span><br><span class="line">            <span class="keyword">synchronized</span> (resourceA) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;threadB get resourceA lock&quot;</span>);</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;threadB try get resourceB lock...&quot;</span>);</span><br><span class="line">                <span class="comment">// è·å–resourceBå…±äº«èµ„æºç›‘è§†å™¨é”</span></span><br><span class="line">                <span class="keyword">synchronized</span> (resourceB) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;threadB get resourceB lock&quot;</span>);</span><br><span class="line">                    <span class="comment">// çº¿ç¨‹Bé˜»å¡, å¹¶é‡Šæ”¾è·å–åˆ°çš„resourceAé”</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;threadA release resourceA lock&quot;</span>);</span><br><span class="line">                    resourceA.wait();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// å¯åŠ¨</span></span><br><span class="line">    threadA.start();</span><br><span class="line">    threadB.start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">    threadA.join();</span><br><span class="line">    threadB.join();</span><br><span class="line">    System.out.println(<span class="string">&quot;test over&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>æ‰§è¡Œç»“æœ: resourceBæ²¡æœ‰è°ƒç”¨wait(), ä¸€ç›´æœªè¢«é‡Šæ”¾è¢«ThreadAæŒæœ‰</p>
<p><a href="/../img/juc/02.png" title="image-20250307102209484" class="gallery-item" style="box-shadow: none;"> <img src="/../img/juc/02.png" alt="image-20250307102209484"></a> </p>
<h4 id="3-2-2-wait-long-timeout-wait-long-timeout-int-nanos"><a href="#3-2-2-wait-long-timeout-wait-long-timeout-int-nanos" class="headerlink" title="3.2.2 wait(long timeout) &#x2F; wait(long timeout, int nanos)"></a>3.2.2 wait(long timeout) &#x2F; wait(long timeout, int nanos)</h4><ol>
<li><p>wait(long timeout)</p>
<p>è¯¥æ–¹æ³•å…è®¸çº¿ç¨‹è¿›å…¥æŒ‚èµ·çŠ¶æ€ï¼Œå¹¶åœ¨æœªè¢« <code>notify()</code> å”¤é†’æˆ–ä¸­æ–­çš„æƒ…å†µä¸‹ï¼Œè¶…è¿‡ <code>timeout</code> æ—¶é—´åè‡ªåŠ¨æ¢å¤æ‰§è¡Œã€‚</p>
</li>
<li><p>wait(long timeout, int nanos)</p>
</li>
</ol>
<p>   è¯¥æ–¹æ³•å†…éƒ¨è°ƒç”¨ <code>wait(long timeout)</code>ï¼Œå½“ <code>nanos &gt; 0</code> æ—¶ï¼Œä¼šå°† <code>timeout</code> å€¼åŠ  1ã€‚</p>
<h4 id="3-2-3-notify-notifyAll"><a href="#3-2-3-notify-notifyAll" class="headerlink" title="3.2.3 notify() &#x2F; notifyAll()"></a>3.2.3 notify() &#x2F; notifyAll()</h4><ol>
<li><p>notify()</p>
<p>è¯¥æ–¹æ³•ç”¨äºå”¤é†’<strong>ä¸€ä¸ª</strong>åœ¨å…±äº«å˜é‡ä¸Šè°ƒç”¨ <code>wait()</code> åè¿›å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œå¹¶<strong>éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹</strong>ã€‚</p>
</li>
<li><p>notifyAll()</p>
<p>è¯¥æ–¹æ³•å”¤é†’<strong>æ‰€æœ‰</strong>åœ¨å…±äº«å˜é‡ä¸Šè°ƒç”¨ <code>wait()</code> åè¿›å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ã€‚</p>
</li>
</ol>
<p>âš  <strong>æ³¨æ„</strong>ï¼šä¸ <code>wait()</code> æ–¹æ³•ç±»ä¼¼ï¼Œ<code>notify()/notifyAll()</code> ä¹Ÿå¿…é¡»åœ¨<strong>è·å–ç›‘è§†å™¨é”</strong>çš„å‰æä¸‹ä½¿ç”¨ï¼Œå› æ­¤<strong>å¿…é¡»åœ¨åŒæ­¥ä»£ç å—æˆ– <code>synchronized</code> ä¿®é¥°çš„æ–¹æ³•å†…è°ƒç”¨</strong>ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>IllegalMonitorStateException</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•wait()åªé‡Šæ”¾å½“å‰å…±äº«å˜é‡çš„é”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testNotify</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">threadA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–Aå…±äº«èµ„æºçš„ç›‘è§†å™¨é”</span></span><br><span class="line">            <span class="keyword">synchronized</span> (resourceA) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;threadA begin wait&quot;</span>);</span><br><span class="line">                resourceA.wait();</span><br><span class="line">                System.out.println(<span class="string">&quot;threadA end wait&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">threadB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (resourceA) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;threadB begin wait&quot;</span>);</span><br><span class="line">                resourceA.wait();</span><br><span class="line">                System.out.println(<span class="string">&quot;threadB end wait&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">threadC</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (resourceA) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;threadC begin notify&quot;</span>);</span><br><span class="line">            resourceA.notify();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// å¯åŠ¨</span></span><br><span class="line">    threadA.start();</span><br><span class="line">    threadB.start();</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    threadC.start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">    threadA.join();</span><br><span class="line">    threadB.join();</span><br><span class="line">    threadC.join();</span><br><span class="line">    System.out.println(<span class="string">&quot;test over&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œæµç¨‹</strong></p>
<ol>
<li><strong>çº¿ç¨‹ A è·å– <code>resourceA</code> ç›‘è§†å™¨é”</strong>ï¼Œæ‰§è¡Œ <code>wait()</code> åï¼š<ul>
<li>è¿›å…¥ <strong>ç­‰å¾…çŠ¶æ€ï¼ˆWaitingï¼‰</strong>ï¼Œé‡Šæ”¾ <code>resourceA</code> é”ã€‚</li>
</ul>
</li>
<li><strong>çº¿ç¨‹ B è·å– <code>resourceA</code> ç›‘è§†å™¨é”</strong>ï¼Œæ‰§è¡Œ <code>wait()</code> åï¼š<ul>
<li>è¿›å…¥ <strong>ç­‰å¾…çŠ¶æ€ï¼ˆWaitingï¼‰</strong>ï¼Œé‡Šæ”¾ <code>resourceA</code> é”ã€‚</li>
</ul>
</li>
<li><strong>çº¿ç¨‹ C è·å– <code>resourceA</code> ç›‘è§†å™¨é”ï¼Œæ‰§è¡Œ <code>notify()</code></strong>ï¼š<ul>
<li>éšæœºå”¤é†’ <strong>ä¸€ä¸ª</strong> çº¿ç¨‹ï¼ˆ<code>threadA</code> æˆ– <code>threadB</code>ï¼‰ã€‚</li>
<li><code>threadC</code> é€€å‡ºåŒæ­¥å—åé‡Šæ”¾ <code>resourceA</code> é”ã€‚</li>
</ul>
</li>
<li><strong>è¢«å”¤é†’çš„çº¿ç¨‹ï¼ˆ<code>threadA</code> æˆ– <code>threadB</code>ï¼‰è·å– <code>resourceA</code> ç›‘è§†å™¨é”</strong>ï¼š<ul>
<li>ç»§ç»­æ‰§è¡Œ <code>wait()</code> ä¹‹åçš„ä»£ç ï¼Œæ‰“å° <code>&quot;threadX end wait&quot;</code>ã€‚</li>
</ul>
</li>
<li><strong>å¦ä¸€ä¸ªçº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€</strong>ï¼Œå› ä¸º <code>notify()</code> <strong>åªå”¤é†’ä¸€ä¸ªçº¿ç¨‹</strong>ã€‚</li>
</ol>
<h3 id="3-3-join"><a href="#3-3-join" class="headerlink" title="3.3 join()"></a>3.3 join()</h3><p>é˜»å¡å½“å‰çº¿ç¨‹, ç­‰å¾…ç›®æ ‡çº¿ç¨‹æ‰§è¡Œå®Œå, å†ç»§ç»­æ‰§è¡Œå½“å‰çº¿ç¨‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•join()ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»“æŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJoin</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;child t1 over&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;child t2 over&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯åŠ¨å­çº¿ç¨‹</span></span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line">    System.out.println(<span class="string">&quot;wait child thread over&quot;</span>);</span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line">    System.out.println(<span class="string">&quot;all child threads over&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Š</strong>ï¼š</p>
<ol>
<li><p><strong><code>t1.join()</code> æ˜¯ä¸»çº¿ç¨‹è°ƒç”¨ <code>t1</code> çš„ <code>join()</code> æ–¹æ³•ï¼š</strong></p>
<ul>
<li><p>è¿™æ˜¯ <strong>ä¸»çº¿ç¨‹</strong> è°ƒç”¨ <code>t1</code> å¯¹è±¡çš„ <code>join()</code> æ–¹æ³•ï¼Œè€Œä¸æ˜¯ <code>t1</code> è‡ªå·±è°ƒç”¨ <code>join()</code>ã€‚æ–¹æ³•è°ƒç”¨çš„å¯¹è±¡æ˜¯ <code>t1</code>ï¼Œä½†å®é™…è§¦å‘è°ƒç”¨çš„æ˜¯ä¸»çº¿ç¨‹ã€‚joinæ–¹æ³•çš„å½“å‰çº¿ç¨‹æ˜¯ä¸»çº¿ç¨‹</p>
</li>
<li><p><code>join()</code> çš„ä½œç”¨æ˜¯è®© <strong>ä¸»çº¿ç¨‹</strong> ç­‰å¾… <code>t1</code> çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚</p>
</li>
</ul>
</li>
<li><p><strong><code>join()</code> æ˜¯ <code>synchronized</code> ä¿®é¥°çš„ï¼Œå®ƒä¼šå…ˆè·å–ç›®æ ‡çº¿ç¨‹çš„é”ï¼š</strong></p>
<ul>
<li><p><code>join()</code> æ–¹æ³•æœ¬èº«æ˜¯ <code>synchronized</code>ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯ <strong>é”ä½ç›®æ ‡çº¿ç¨‹å¯¹è±¡</strong> çš„ã€‚åœ¨ <code>join()</code> è¢«è°ƒç”¨æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šè¯·æ±‚ç›®æ ‡çº¿ç¨‹ï¼ˆ<code>t1</code>ï¼‰çš„å¯¹è±¡é”ã€‚</p>
</li>
<li><p>è¿™ä¸æ˜¯â€œè·å–ç›®æ ‡çº¿ç¨‹çš„é”â€â€”â€”å®é™…ä¸Šæ˜¯é”ä½ç›®æ ‡çº¿ç¨‹å¯¹è±¡ï¼ˆ<code>t1</code>ï¼‰æœ¬èº«ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿ <code>join()</code> ä¸ä¼šè¢«åŒæ—¶è°ƒç”¨å¤šæ¬¡ï¼Œé¿å…çŠ¶æ€æ··ä¹±ã€‚</p>
</li>
</ul>
</li>
<li><p><strong><code>wait()</code> ä¼šä½¿ä¸»çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼š</strong></p>
<ul>
<li><p>åœ¨ <code>join()</code> æ–¹æ³•å†…ï¼Œä¸»çº¿ç¨‹è°ƒç”¨ <code>wait()</code> æ–¹æ³•ã€‚è°ƒç”¨ <code>wait()</code> åï¼Œ<strong>ä¸»çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€</strong>ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹ï¼ˆ<code>t1</code>ï¼‰æ‰§è¡Œå®Œæ¯•ã€‚</p>
</li>
<li><p>è¿™é‡Œæ˜¯ä¸»çº¿ç¨‹è¿›å…¥äº†ç­‰å¾…çŠ¶æ€ï¼Œç›®æ ‡çº¿ç¨‹ <code>t1</code> å®Œæˆæ‰§è¡Œåï¼Œä¸»çº¿ç¨‹æ‰ä¼šè¢«å”¤é†’ã€‚</p>
</li>
</ul>
</li>
<li><p><strong><code>Thread.isAlive()</code> æ–¹æ³•ï¼š</strong></p>
<ul>
<li><p><code>isAlive()</code> ç”¨æ¥åˆ¤æ–­ç›®æ ‡çº¿ç¨‹ï¼ˆ<code>t1</code>ï¼‰æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ï¼ˆå³æ˜¯å¦è¿˜åœ¨æ‰§è¡Œä¸­ï¼‰ã€‚å®ƒä¼šæ ¹æ®ç›®æ ‡çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–æ›´æ–°çŠ¶æ€ã€‚</p>
</li>
<li><p>åªæœ‰å½“ <code>t1</code> çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œ<code>isAlive()</code> è¿”å› <code>false</code>ã€‚å½“ <code>isAlive()</code> ä¸º <code>false</code> æ—¶ï¼ŒJVM ä¼šé€šçŸ¥ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹è¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œåç»­ä»£ç ã€‚</p>
</li>
</ul>
</li>
</ol>
<h3 id="3-4-sleep"><a href="#3-4-sleep" class="headerlink" title="3.4 sleep()"></a>3.4 sleep()</h3><p>é™æ€sleepæ–¹æ³•, å¯ä»¥ä½¿è°ƒç”¨çº¿ç¨‹æš‚æ—¶è®©å‡ºæŒ‡å®šæ—¶é—´çš„æ‰§è¡Œæƒ, ä½†æ˜¯è¯¥çº¿ç¨‹æ‰€æ‹¥æœ‰çš„ç›‘è§†å™¨èµ„æºä»¥åŠé”ä¸ä¼šè®©å‡º, ç»§ç»­è¢«è¯¥çº¿ç¨‹æŒæœ‰, è¶…å‡ºç¡çœ æ—¶é—´åè¯¥çº¿ç¨‹ä¼šè¿›å…¥å°±ç»ªæ€, ç­‰å¾…CPUè°ƒåº¦ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSleep</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;t1 is in sleep&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;t1 is awake&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;t2 is in sleep&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;t2 is awake&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Š</strong>ï¼š</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>Thread.sleep()</code> ä½¿çº¿ç¨‹è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œä½†çº¿ç¨‹æ‰€æŒæœ‰çš„é”å¹¶ä¸ä¼šè¢«é‡Šæ”¾ï¼Œç›´åˆ°è¯¥çº¿ç¨‹å®Œæˆç¡çœ å¹¶è¿›å…¥å°±ç»ªæ€ã€‚å› æ­¤ï¼Œåœ¨ <code>t1</code> æˆ– <code>t2</code> ä¸­ï¼Œå°½ç®¡çº¿ç¨‹æ­£åœ¨ç¡çœ ï¼Œä½†å®ƒä»¬æ‰€æŒæœ‰çš„ <code>lock</code> é”ä¼šä¸€ç›´ä¿æŒï¼Œç›´åˆ°å®ƒä»¬æ‰§è¡Œå®Œ <code>sleep</code> å¹¶é‡Šæ”¾é”ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼š</p>
<ol>
<li><strong>é”çš„è¡Œä¸º</strong>ï¼šçº¿ç¨‹è°ƒç”¨ <code>lock.lock()</code> è·å–äº† <code>ReentrantLock</code>ï¼Œå¹¶åœ¨è¿›å…¥ <code>Thread.sleep(10000)</code> åå¹¶æœªé‡Šæ”¾é”ï¼Œå¯¼è‡´å¦ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½è·å–é”å¹¶è¿›å…¥ç¡çœ ã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹ä»ç„¶æŒæœ‰é”ï¼Œå³ä½¿å®ƒè¿›å…¥äº†ç¡çœ çŠ¶æ€ã€‚</li>
<li><strong>æ‰§è¡Œé¡ºåº</strong>ï¼šç”±äº <code>t1</code> å’Œ <code>t2</code> çº¿ç¨‹åœ¨ <code>lock.lock()</code> é˜»å¡æ—¶ç›¸äº’ç­‰å¾…ï¼Œå®é™…è¡¨ç°ä¸ºå…ˆæ‰§è¡Œå®Œä¸€ä¸ªçº¿ç¨‹ï¼ˆæ‰“å°å®Œ <code>t1 is in sleep</code> å’Œ <code>t1 is awake</code>ï¼‰ï¼Œç„¶åæ‰ä¼šæ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ã€‚è¿™æ˜¯å› ä¸ºæŒæœ‰é”çš„çº¿ç¨‹åœ¨ç¡çœ æœŸé—´ï¼Œé”ä¸ä¼šé‡Šæ”¾ï¼Œå¯¼è‡´å¦ä¸€ä¸ªçº¿ç¨‹æ— æ³•æ‰§è¡Œã€‚</li>
<li><strong>çº¿ç¨‹è°ƒåº¦</strong>ï¼šå°½ç®¡çº¿ç¨‹è¿›å…¥äº†ç¡çœ çŠ¶æ€å¹¶è®©å‡º CPU æ‰§è¡Œæƒï¼Œä½†ç”±äº <code>sleep</code> å¹¶æ²¡æœ‰é‡Šæ”¾é”ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å¾—é”å¹¶æ‰§è¡Œï¼Œç›´åˆ°å½“å‰çº¿ç¨‹å®Œæˆç¡çœ å¹¶é‡Šæ”¾é”ã€‚</li>
</ol>
<h3 id="3-5-yield"><a href="#3-5-yield" class="headerlink" title="3.5 yield()"></a>3.5 yield()</h3><p>Threadç±»çš„é™æ€æ–¹æ³•, å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¯¥æ–¹æ³•æ—¶, è¡¨æ˜è®©å‡ºè‡ªå·±çš„CPUä½¿ç”¨æƒ, è½¬ä¸ºå°±ç»ªæ€, è¿›å…¥å°±ç»ªé˜Ÿåˆ—ç­‰å¾…è¢«è°ƒåº¦, CPUä¼šæŒ‰ç…§ä¼˜å…ˆçº§é€‰å–ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œè°ƒåº¦, ä¹Ÿæœ‰å¯èƒ½é€‰å‡ºåŸçº¿ç¨‹ã€‚</p>
<h3 id="3-6-çº¿ç¨‹ä¸­æ–­"><a href="#3-6-çº¿ç¨‹ä¸­æ–­" class="headerlink" title="3.6 çº¿ç¨‹ä¸­æ–­"></a>3.6 çº¿ç¨‹ä¸­æ–­</h3><p>Java çš„çº¿ç¨‹ä¸­æ–­æ˜¯ä¸€ç§çº¿ç¨‹é—´çš„åä½œæœºåˆ¶ï¼Œçº¿ç¨‹å¯ä»¥é€šè¿‡ä¸­æ–­æ ‡è¯†è¿›è¡Œè‡ªæˆ‘ç»ˆæ­¢ï¼Œè€Œä¸ä¼šè¢«å¼ºåˆ¶å…³é—­ã€‚çº¿ç¨‹æ˜¯å¦ç»ˆæ­¢å®Œå…¨å–å†³äºè‡ªèº«çš„é€»è¾‘æ§åˆ¶ï¼Œè€Œé <code>interrupt()</code> æ–¹æ³•ç›´æ¥åœæ­¢çº¿ç¨‹æ‰§è¡Œã€‚</p>
<ol>
<li><p><strong>void interrupt()</strong> </p>
<p>ç”¨äºè®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡è¯†ï¼Œé€šçŸ¥çº¿ç¨‹åº”å½“è‡ªè¡Œå¤„ç†ä¸­æ–­ã€‚</p>
</li>
<li><p><strong>boolean isInterrupted():</strong> </p>
<p>æ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œè‹¥å·²ä¸­æ–­è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ï¼Œä½†ä¸ä¼šæ¸…é™¤ä¸­æ–­æ ‡è¯†ã€‚</p>
</li>
<li><p><strong>boolean interrupted():</strong> </p>
<p>ä½œç”¨ç±»ä¼¼ <code>isInterrupted()</code>ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ£€æŸ¥å½“å‰è°ƒç”¨çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œå¹¶ä¼š <strong>æ¸…é™¤</strong> ä¸­æ–­æ ‡è¯†ã€‚</p>
</li>
</ol>
<p><strong>çº¿ç¨‹ä¸­æ–­æ¡ˆä¾‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInterrupt</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// å½“å‰çº¿ç¨‹è¢«ç»ˆæ­¢åˆ™é€€å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread() + <span class="string">&quot; ing&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    thread.start();</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    <span class="comment">// ä¸­æ–­å­çº¿ç¨‹</span></span><br><span class="line">    System.out.println(<span class="string">&quot;main thread interrupt thread&quot;</span>);</span><br><span class="line">    thread.interrupt();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">    thread.join();</span><br><span class="line">    System.out.println(<span class="string">&quot;main is over&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ul>
<li>çº¿ç¨‹åœ¨ <strong>é˜»å¡çŠ¶æ€</strong>ï¼ˆå¦‚ <code>sleep()</code>ã€<code>wait()</code>ã€<code>join()</code> ç­‰ï¼‰æ—¶ï¼Œè‹¥è¢« <code>interrupt()</code>ï¼Œå°†ä¼šæŠ›å‡º <code>InterruptedException</code>ï¼Œå¹¶ <strong>æ¸…é™¤</strong> çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ã€‚</li>
<li>å› æ­¤ï¼Œåœ¨æ•è·å¼‚å¸¸åï¼Œéœ€è¦å†æ¬¡è®¾ç½® <code>Thread.currentThread().interrupt()</code>ï¼Œç¡®ä¿ä¸­æ–­çŠ¶æ€å¾—ä»¥ä¿ç•™ï¼Œä»è€Œæ­£ç¡®ç»ˆæ­¢çº¿ç¨‹ã€‚</li>
</ul>
<h3 id="3-7-çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#3-7-çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="3.7 çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>3.7 çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><p>å½“æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„çº¿ç¨‹éœ€è¦è¢«CPUè°ƒåº¦æ—¶, éœ€è¦ä¿ç•™å½“å‰çº¿ç¨‹çš„æ‰§è¡Œç°åœºä¿¡æ¯, å†æ¬¡æ‰§è¡Œæ—¶æ ¹æ®ä¿å­˜çš„æ‰§è¡Œç°åœºä¿¡æ¯å›å¤æ‰§è¡Œç°åœºã€‚</p>
<h3 id="3-8-çº¿ç¨‹æ­»é”"><a href="#3-8-çº¿ç¨‹æ­»é”" class="headerlink" title="3.8 çº¿ç¨‹æ­»é”"></a>3.8 çº¿ç¨‹æ­»é”</h3><ol>
<li><p><strong>ä»€ä¹ˆæ˜¯æ­»é”?</strong></p>
<p>2ä¸ªåŠ2ä¸ªä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å› äº‰å¤ºèµ„æºè€Œäº’ç›¸ç­‰å¾…çš„ç°è±¡, åœ¨æ— å¤–åŠ›çš„ä½œç”¨ä¸‹, ä¼šä¸€ç›´ç›¸äº’ç­‰å¾…æ— æ³•ç»§ç»­è¿è¡Œã€‚</p>
</li>
<li><p><strong>äº§ç”Ÿæ­»é”çš„æ¡ä»¶</strong></p>
<ol>
<li><p>äº’æ–¥æ¡ä»¶</p>
<p>çº¿ç¨‹å¯¹å·²å æœ‰çš„èµ„æºè¿›è¡Œæ’å®ƒæ€§ä½¿ç”¨, å³è¯¥èµ„æºåŒæ—¶åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€å æœ‰ã€‚</p>
</li>
<li><p>è¯·æ±‚å¹¶æŒæœ‰æ¡ä»¶</p>
<p>ä¸€ä¸ªçº¿ç¨‹å·²ç»æŒæœ‰äº†è‡³å°‘ä¸€ä¸ªèµ„æº, ä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚, æ–°çš„èµ„æºè¢«å…¶å®ƒçº¿ç¨‹å æœ‰, æ‰€ä»¥å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡, åˆä¸ä¼šé‡Šæ”¾å·²æŒæœ‰çš„èµ„æºã€‚</p>
</li>
<li><p>ä¸å¯å‰¥å¤ºæ¡ä»¶</p>
<p>çº¿ç¨‹è·å–åˆ°çš„èµ„æºåœ¨è‡ªå·±ä½¿ç”¨å®Œå‰ä¸èƒ½è¢«å…¶å®ƒçº¿ç¨‹æŠ¢å ã€‚</p>
</li>
<li><p>ç¯è·¯ç­‰å¾…æ¡ä»¶</p>
<p>å‘ç”Ÿæ­»é”æ—¶, å¿…ç„¶å‡ºç°ä¸€ä¸ªçº¿ç¨‹èµ„æºç¯å½¢é“¾, å³T0-&gt;T1-&gt; â€¦ -&gt; T0, è¿™äº›çº¿ç¨‹ç›¸äº’ç­‰å¾…åç»§çº¿ç¨‹çš„èµ„æºã€‚</p>
</li>
</ol>
</li>
</ol>
<p><strong>æ­»é”ä»£ç æ¡ˆä¾‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">resourceA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">resourceB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeadLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">threadA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (resourceA) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread() + <span class="string">&quot;get ResourceA&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(Thread.currentThread() + <span class="string">&quot;waiting get ResourceB&quot;</span>);</span><br><span class="line">            <span class="keyword">synchronized</span> (resourceB) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread() + <span class="string">&quot;get ResourceB&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">threadB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (resourceB) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread() + <span class="string">&quot;get ResourceB&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(Thread.currentThread() + <span class="string">&quot;waiting get ResourceA&quot;</span>);</span><br><span class="line">            <span class="keyword">synchronized</span> (resourceA) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread() + <span class="string">&quot;get ResourceA&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    threadA.start();</span><br><span class="line">    threadB.start();</span><br><span class="line">    threadA.join();</span><br><span class="line">    threadB.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æµç¨‹åˆ†æ:</strong></p>
<p>Açº¿ç¨‹å æœ‰resourceAçš„ç›‘è§†å™¨é”èµ„æº, ç¡çœ ç­‰å¾…Bçº¿ç¨‹å æœ‰resourceBçš„ç›‘è§†å™¨é”èµ„æº, å½“ç›‘è§†å™¨é”èµ„æºè¢«å æœ‰æ—¶, è¯¥èµ„æºå°†æ— æ³•è¢«å…¶å®ƒçº¿ç¨‹è·å–, å½“A Bçº¿ç¨‹äº’ç›¸è·å–å¯¹æ–¹çº¿ç¨‹å æœ‰èµ„æºæ—¶å°±ä¼šå¯¼è‡´æ­»é”ã€‚</p>
<h3 id="3-9-å®ˆæŠ¤çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹"><a href="#3-9-å®ˆæŠ¤çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹" class="headerlink" title="3.9 å®ˆæŠ¤çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹"></a>3.9 å®ˆæŠ¤çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹</h3><p>åœ¨ Java ä¸­ï¼Œçº¿ç¨‹åˆ†ä¸º <strong>ç”¨æˆ·çº¿ç¨‹</strong> å’Œ <strong>å®ˆæŠ¤çº¿ç¨‹</strong>ã€‚<strong>JVM åªæœ‰åœ¨æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åæ‰ä¼šé€€å‡º</strong>ï¼Œæ— è®ºæ˜¯å¦ä»ç„¶å­˜åœ¨å®ˆæŠ¤çº¿ç¨‹ã€‚<br><strong>ä»£ç ç¤ºä¾‹:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// å½“ä¸»çº¿ç¨‹(ç”¨æˆ·çº¿ç¨‹)ç»“æŸæ—¶, å­ç”¨æˆ·çº¿ç¨‹ä¸€ç›´åœ¨è¿è¡Œ, JVMä¸ä¼šé€€å‡º</span></span><br><span class="line">    <span class="comment">// è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹å ä¸»çº¿ç¨‹ç»“æŸ JVMè‡ªåŠ¨é€€å‡º</span></span><br><span class="line">    thread.setDaemon(<span class="literal">true</span>);</span><br><span class="line">    thread.start();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æµç¨‹åˆ†æ:</strong></p>
<p><strong>å½“ <code>thread</code> æœªè®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼ˆé»˜è®¤æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼‰</strong></p>
<ul>
<li>ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œ<code>thread</code> ä»ç„¶æ˜¯<strong>ç”¨æˆ·çº¿ç¨‹</strong>ï¼Œå› æ­¤ JVM <strong>ä¸ä¼šé€€å‡º</strong>ï¼Œä¼šä¸€ç›´è¿è¡Œã€‚</li>
</ul>
<p><strong>å½“ <code>thread</code> è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹</strong>ï¼ˆ<code>setDaemon(true)</code>ï¼‰</p>
<ul>
<li>ä¸»çº¿ç¨‹ç»“æŸåï¼ŒJVM æ£€æµ‹åˆ°<strong>æ²¡æœ‰å­˜æ´»çš„ç”¨æˆ·çº¿ç¨‹</strong>ï¼Œå³ä½¿ <code>thread</code> ä»åœ¨è¿è¡Œï¼ŒJVM ä¹Ÿä¼š<strong>è‡ªåŠ¨é€€å‡º</strong>ã€‚</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ol>
<li><p>å®ˆæŠ¤çº¿ç¨‹çš„å…¸å‹åº”ç”¨</p>
<ol>
<li>GCçº¿ç¨‹</li>
<li>åå°æ—¥å¿—è®°å½•çº¿ç¨‹</li>
<li>å®šæ—¶ä»»åŠ¡è°ƒåº¦çº¿ç¨‹</li>
</ol>
</li>
<li><p>å®ˆæŠ¤çº¿ç¨‹å¯èƒ½ä¸ä¼šæ‰§è¡Œå®Œæ•´ä»»åŠ¡</p>
<p>JVMå¹¶ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œç»“æŸæ‰é€€å‡º</p>
</li>
</ol>
<h3 id="3-10-ThreadLocal"><a href="#3-10-ThreadLocal" class="headerlink" title="3.10 ThreadLocal"></a>3.10 ThreadLocal</h3><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹å…±äº«å˜é‡çš„è®¿é—®å¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å¸¸è§çš„è§£å†³æ–¹æ¡ˆåŒ…æ‹¬åŠ é”æˆ–ä½¿ç”¨ <strong>ThreadLocal</strong> å˜é‡ã€‚</p>
<h4 id="3-10-1-ThreadLocal-çš„åŸºæœ¬æ¦‚å¿µ"><a href="#3-10-1-ThreadLocal-çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="3.10.1 ThreadLocal çš„åŸºæœ¬æ¦‚å¿µ"></a>3.10.1 ThreadLocal çš„åŸºæœ¬æ¦‚å¿µ</h4><p><strong>ThreadLocal ä½œç”¨</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æœ¬åœ°å˜é‡å‰¯æœ¬ï¼Œé¿å…å…±äº«å˜é‡å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li>
<li>é€‚ç”¨äºçº¿ç¨‹ä¹‹é—´éœ€è¦éš”ç¦»ä½†åœ¨åŒä¸€çº¿ç¨‹å†…éœ€è¦å…±äº«çš„åœºæ™¯ï¼Œå¦‚ç”¨æˆ·ä¼šè¯ã€äº‹åŠ¡ç®¡ç†ç­‰ã€‚</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª ThreadLocal å®ä¾‹</span></span><br><span class="line">ThreadLocal&lt;String&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(String str)</span> &#123;</span><br><span class="line">    System.out.println(str + <span class="string">&quot;: &quot;</span> + threadLocal.get());</span><br><span class="line">    threadLocal.remove(); <span class="comment">// æ¸…ç†çº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testThreadLocalPrint</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">threadA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        threadLocal.set(<span class="string">&quot;threadA local value&quot;</span>);</span><br><span class="line">        print(<span class="string">&quot;threadA&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;threadA remove after: &quot;</span> + threadLocal.get());</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">threadB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        threadLocal.set(<span class="string">&quot;threadB local value&quot;</span>);</span><br><span class="line">        print(<span class="string">&quot;threadB&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;threadB remove after: &quot;</span> + threadLocal.get());</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    threadA.start();</span><br><span class="line">    threadB.start();</span><br><span class="line">    threadA.join();</span><br><span class="line">    threadB.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¿è¡Œç»“æœ</strong>ï¼š</p>
<ul>
<li><code>threadA</code> è®¾ç½®çš„å€¼ä¸ä¼šå½±å“ <code>threadB</code>ï¼ŒéªŒè¯äº† ThreadLocal å˜é‡çš„çº¿ç¨‹éš”ç¦»æ€§ã€‚</li>
</ul>
<h4 id="3-10-2-ThreadLocal-å®ç°åŸç†"><a href="#3-10-2-ThreadLocal-å®ç°åŸç†" class="headerlink" title="3.10.2 ThreadLocal å®ç°åŸç†"></a>3.10.2 ThreadLocal å®ç°åŸç†</h4><p><strong>æ ¸å¿ƒæ•°æ®ç»“æ„</strong>ï¼š</p>
<ul>
<li><code>Thread</code> ç±»ä¸­æœ‰ <code>threadLocals</code> å’Œ <code>inheritableThreadLocals</code>ï¼Œå‡ä¸º <code>ThreadLocal.ThreadLocalMap</code> ç±»å‹ã€‚</li>
<li><code>ThreadLocalMap</code> æœ¬è´¨æ˜¯ä¸€ä¸ª <strong>æ•£åˆ—è¡¨ (HashMap ç»“æ„)</strong>ï¼Œå­˜å‚¨ <code>ThreadLocal</code> å®ä¾‹ä¸º <strong>Key</strong>ï¼Œçº¿ç¨‹ç§æœ‰å˜é‡ä¸º <strong>Value</strong>ã€‚</li>
</ul>
<ol>
<li><p><strong>set() æ–¹æ³•</strong>ï¼ˆå­˜å‚¨æ•°æ®ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="comment">// å¦‚æœmapä¸ä¸ºç©º, è¡¨æ˜å½“å‰çº¿ç¨‹å¹¶éç¬¬ä¸€æ¬¡è°ƒç”¨ThreadLocal.set, ç›´æ¥å­˜æ”¾</span></span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// this: å½“å‰ThreadLocalçš„å®ä¾‹å¯¹è±¡å¼•ç”¨  value: setæ–¹æ³•ä¼ é€’çš„å€¼</span></span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨set(), éœ€è¦ä¸ºè¯¥çº¿ç¨‹åˆ›å»ºthreadLocalså˜é‡ </span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å½“å‰çº¿ç¨‹çš„threadLocalså˜é‡</span></span><br><span class="line">ThreadLocalMap <span class="title function_">getMap</span><span class="params">(Thread t)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> t.threadLocals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºå½“å‰çº¿ç¨‹åˆ›å»º threadLocals </span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">createMap</span><span class="params">(Thread t, T firstValue)</span> &#123;</span><br><span class="line">    t.threadLocals = <span class="keyword">new</span> <span class="title class_">ThreadLocalMap</span>(<span class="built_in">this</span>, firstValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è·å–å½“å‰çº¿ç¨‹ <code>threadLocals</code>ï¼Œè‹¥å·²å­˜åœ¨ï¼Œåˆ™ç›´æ¥å­˜å€¼ã€‚</li>
<li>è‹¥ <code>threadLocals</code> ä¸ºç©ºï¼Œåˆ™åˆ›å»ºæ–°çš„ <code>ThreadLocalMap</code>ã€‚</li>
</ul>
</li>
<li><p><strong>get() æ–¹æ³•</strong>ï¼ˆè·å–æ•°æ®ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹çš„threadLocals</span></span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="comment">// ä¸ä¸ºnullè¯´æ˜å½“å‰çº¿ç¨‹è°ƒç”¨è¿‡setæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// keyæ˜¯å½“å‰ThreadLocalå®ä¾‹çš„å¼•ç”¨å¯¹è±¡</span></span><br><span class="line">        ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> map.getEntry(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å½“å‰çº¿ç¨‹çš„threadLocalsä¸ºç©º, åˆ™åˆå§‹åŒ–å½“å‰çº¿ç¨‹çš„threadLocalsæˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å½“å‰çº¿ç¨‹çš„ threadLocals</span></span><br><span class="line">ThreadLocalMap <span class="title function_">getMap</span><span class="params">(Thread t)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> t.threadLocals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> T <span class="title function_">setInitialValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å½“å‰çº¿ç¨‹å‰¯æœ¬å˜é‡çš„å€¼ä¸ºnull</span></span><br><span class="line">    <span class="type">T</span> <span class="variable">value</span> <span class="operator">=</span> initialValue();</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰çº¿ç¨‹threadLocalsæ˜¯å¦ä¸ºnull, ä¸ä¸ºnullåˆ™ç›´æ¥èµ‹å€¼, ä¸ºç©ºåˆ™åˆ›å»ºThreadLocalMap</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        createMap(t, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åœ¨çº¿ç¨‹ä»»åŠ¡ç»“æŸæ—¶(ç»ˆæ­¢æ€)è‡ªåŠ¨æ¸…ç†threadLocal</span></span><br><span class="line">    <span class="comment">// æ™®é€šçº¿ç¨‹å¯ä»¥æ‰‹åŠ¨removeä¹Ÿå¯ä»¥é€šè¿‡è¯¥æœºåˆ¶æ¸…ç†threadLocal</span></span><br><span class="line">    <span class="comment">// çº¿ç¨‹æ± ä¸­çº¿ç¨‹ä¼šå¤ç”¨, ä¸ä¸€å®šä¼šè¢«æ¸…ç†è¯¥æœºåˆ¶ä¸ä¸€å®šç”Ÿæ•ˆ, æœ€å¥½æ‰‹åŠ¨remove</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span> <span class="keyword">instanceof</span> TerminatingThreadLocal) &#123;</span><br><span class="line">        TerminatingThreadLocal.register((TerminatingThreadLocal&lt;?&gt;) <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–threadLocalsçš„å€¼ä¸ºnull </span></span><br><span class="line"><span class="keyword">protected</span> T <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å…ˆå°è¯•è·å–å½“å‰çº¿ç¨‹çš„ <code>threadLocals</code>ï¼Œè‹¥å­˜åœ¨åˆ™å–å€¼ï¼Œå¦åˆ™åˆå§‹åŒ–ã€‚</li>
<li><code>**initialValue()**</code> <strong>é»˜è®¤è¿”å› nullï¼Œå¯é€šè¿‡é‡å†™æä¾›é»˜è®¤å€¼ã€‚</strong></li>
</ul>
</li>
<li><p><strong>remove() æ–¹æ³•</strong>ï¼ˆæ¸…ç†æ•°æ®ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="comment">// å½“å‰çº¿ç¨‹çš„threadLocals ä¸ä¸ºnull</span></span><br><span class="line">     <span class="type">ThreadLocalMap</span> <span class="variable">m</span> <span class="operator">=</span> getMap(Thread.currentThread());</span><br><span class="line">     <span class="keyword">if</span> (m != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="comment">// ä»¥å½“å‰threaLocalçš„å®ä¾‹å¼•ç”¨ä¸ºkey, è¿›è¡Œæ¸…ç†</span></span><br><span class="line">         m.remove(<span class="built_in">this</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(ThreadLocal&lt;?&gt; key)</span> &#123;</span><br><span class="line">        Entry[] tab = table;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> key.threadLocalHashCode &amp; (len-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> tab[i];</span><br><span class="line">             e != <span class="literal">null</span>;</span><br><span class="line">             e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.get() == key) &#123;</span><br><span class="line">                e.clear();</span><br><span class="line">                expungeStaleEntry(i);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ¸…é™¤å½“å‰çº¿ç¨‹ <code>ThreadLocalMap</code> ä¸­çš„ <code>this</code> å¯¹åº”çš„å€¼ã€‚</li>
<li>é¿å…çº¿ç¨‹æ± å¤ç”¨å¯¼è‡´çš„å†…å­˜æ³„æ¼ã€‚</li>
</ul>
</li>
</ol>
<h4 id="3-10-3-ThreadLocal-ä¸æ”¯æŒç»§æ‰¿"><a href="#3-10-3-ThreadLocal-ä¸æ”¯æŒç»§æ‰¿" class="headerlink" title="3.10.3 ThreadLocal ä¸æ”¯æŒç»§æ‰¿"></a>3.10.3 ThreadLocal ä¸æ”¯æŒç»§æ‰¿</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>å­çº¿ç¨‹æ— æ³•ç»§æ‰¿çˆ¶çº¿ç¨‹çš„ ThreadLocal å˜é‡</strong>ã€‚</p>
<p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; notExtendThreadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testThreadLocalNotExtend</span><span class="params">()</span> &#123;</span><br><span class="line">    notExtendThreadLocal.set(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">threadA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;thread: &quot;</span> + notExtendThreadLocal.get()); <span class="comment">// null</span></span><br><span class="line">    &#125;);</span><br><span class="line">    threadA.start();</span><br><span class="line">    System.out.println(<span class="string">&quot;main: &quot;</span> + notExtendThreadLocal.get()); <span class="comment">// hello world</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºç»“æœ</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">main: hello world</span><br><span class="line">thread: null</span><br></pre></td></tr></table></figure>

<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li><code>get()</code> æ–¹æ³•è·å–çš„æ˜¯å½“å‰çº¿ç¨‹çš„ <code>threadLocals</code>ï¼Œå­çº¿ç¨‹æ— æ³•è®¿é—®çˆ¶çº¿ç¨‹çš„æ•°æ®ã€‚</li>
</ul>
<h4 id="3-10-4-InheritableThreadLocalï¼ˆæ”¯æŒç»§æ‰¿ï¼‰"><a href="#3-10-4-InheritableThreadLocalï¼ˆæ”¯æŒç»§æ‰¿ï¼‰" class="headerlink" title="3.10.4  InheritableThreadLocalï¼ˆæ”¯æŒç»§æ‰¿ï¼‰"></a>3.10.4  InheritableThreadLocalï¼ˆæ”¯æŒç»§æ‰¿ï¼‰</h4><p><code>InheritableThreadLocal</code> å…è®¸ <strong>å­çº¿ç¨‹ç»§æ‰¿çˆ¶çº¿ç¨‹çš„æœ¬åœ°å˜é‡</strong>ã€‚</p>
<p><strong>æ ¸å¿ƒåŸç†</strong>ï¼š</p>
<ul>
<li><code>Thread</code> æ„é€ æ–¹æ³•ä¼šæ£€æŸ¥ <strong>çˆ¶çº¿ç¨‹çš„</strong> <code>**inheritableThreadLocals**</code>ï¼Œè‹¥ä¸ä¸ºç©ºï¼Œåˆ™ <strong>å¤åˆ¶ç»™å­çº¿ç¨‹</strong>ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; extendThreadLocal = <span class="keyword">new</span> <span class="title class_">InheritableThreadLocal</span>&lt;&gt;();</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testThreadLocalExtend</span><span class="params">()</span> &#123;</span><br><span class="line">    extendThreadLocal.set(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">threadA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;thread: &quot;</span> + extendThreadLocal.get());</span><br><span class="line">    &#125;);</span><br><span class="line">    threadA.start();</span><br><span class="line">    System.out.println(<span class="string">&quot;main: &quot;</span> + extendThreadLocal.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æºç åˆ†æ</strong>ï¼ˆå­çº¿ç¨‹ç»§æ‰¿å˜é‡ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InheritableThreadLocal</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">ThreadLocal</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> T <span class="title function_">childValue</span><span class="params">(T parentValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> parentValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getæ–¹æ³•è·å–çš„æ˜¯å½“å‰çº¿ç¨‹çš„inheritableThreadLocals, è€Œä¸æ˜¯threadLocals </span></span><br><span class="line">    ThreadLocalMap <span class="title function_">getMap</span><span class="params">(Thread t)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> t.inheritableThreadLocals;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨setæ–¹æ³•æ—¶, åˆ›å»ºçš„æ˜¯å½“å‰çº¿ç¨‹çš„inheritableThreadLocals, è€Œä¸æ˜¯threadLocals</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">createMap</span><span class="params">(Thread t, T firstValue)</span> &#123;</span><br><span class="line">        t.inheritableThreadLocals = <span class="keyword">new</span> <span class="title class_">ThreadLocalMap</span>(<span class="built_in">this</span>, firstValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Thread æ„é€ å™¨æºç </span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">Thread</span><span class="params">(ThreadGroup g, Runnable target, String name,</span></span><br><span class="line"><span class="params">                   <span class="type">long</span> stackSize, AccessControlContext acc,</span></span><br><span class="line"><span class="params">                   <span class="type">boolean</span> inheritThreadLocals)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;name cannot be null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">		<span class="comment">// è·å–è°ƒç”¨æ„é€ æ–¹æ³•åˆ›å»ºçº¿ç¨‹çš„çº¿ç¨‹, å³çˆ¶çº¿ç¨‹, æµ‹è¯•æ¡ˆä¾‹ä¸­å³ä¸»çº¿ç¨‹çˆ¶ threadAå­</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">parent</span> <span class="operator">=</span> currentThread();</span><br><span class="line">        ...çœç•¥æ— å…³ä»£ç ...  </span><br><span class="line">        <span class="comment">// å¦‚æœçˆ¶çº¿ç¨‹ä½¿ç”¨äº†inheritableThreadLocals</span></span><br><span class="line">        <span class="keyword">if</span> (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != <span class="literal">null</span>)</span><br><span class="line">			<span class="comment">// å­çº¿ç¨‹å¤åˆ¶çˆ¶çº¿ç¨‹çš„inheritableThreadLocalså®ç°å­çº¿ç¨‹ç»§æ‰¿çˆ¶çº¿ç¨‹çš„æœ¬åœ°å˜é‡</span></span><br><span class="line">            <span class="built_in">this</span>.inheritableThreadLocals =</span><br><span class="line">                ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.stackSize = stackSize;</span><br><span class="line">        <span class="built_in">this</span>.tid = nextThreadID();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> ThreadLocalMap <span class="title function_">createInheritedMap</span><span class="params">(ThreadLocalMap parentMap)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadLocalMap</span>(parentMap);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>createInheritedMap(parent.inheritableThreadLocals)</code>ï¼šå¤åˆ¶çˆ¶çº¿ç¨‹çš„ <code>inheritableThreadLocals</code>ã€‚</p>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-04-01</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« Ethan</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/Java/'>
                            Java
                        </a>
                    
                        <a href='/tags/JUC/'>
                            JUC
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/JUC/'>
                            JUC
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>ä¸Šä¸€ç¯‡ï¼š<a href='/2023/04/10/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_02/'>äºŒã€Javaå¹¶å‘ç¼–ç¨‹-å¹¶å‘åŸºç¡€</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/2023/01/01/java%E9%9D%A2%E8%AF%95%E9%A2%98/">ä¸€ã€é¢†åŸŸé©±åŠ¨è®¾è®¡-ç†è®ºç¯‡</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2025 China 

            
                

            
                
                    / <a href="/contact/"> è”ç³» </a>
                

            
                
                    / <a href="/support/"> æ”¯æŒ </a>
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>âœ¨&#34;The only way to achieve the impossible is to believe it is possible.&#34; âœ¨</span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>