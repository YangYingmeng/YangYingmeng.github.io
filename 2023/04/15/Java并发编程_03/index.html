<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="ä¸€ã€Javaå¹¶å‘ç¼–ç¨‹-Javaå¹¶å‘åŒ…æºç " />
    <meta name="hexo-theme-A4" content="v1.9.7" />
    <link rel="alternate icon" type="image/webp" href="/img/avatar.png">
    <title>Ethan-é€é“æ—¥è®° | true</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


   
        
<link rel="stylesheet" href="/css/custom.css">

    

<meta name="generator" content="Hexo 7.3.0"></head>
    
    
        <style>
            .index-main{
                max-width:  1200px;
            }
        </style>

    
    



    

    
    




    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    

    <div class="index-header-line" >
        <div id="hiddenHeaderContentArray" style="display: none;">
            
            
            
                <span>Your only limit is your mind.</span>
            
        </div>
        <span id="targetSpan"></span>
    </div>


<div class="header">
    <div class="header-container">
        <style>
            .header-img {
                width: 56px;
                height: auto;
                object-fit: cover; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
                transition: transform 0.3s ease-in-out; 
                border-radius: 0; 
            }
            
        </style>
        <img 
            alt="^-^" 
            cache-control="max-age=86400" 
            class="header-img" 
            src="/img/avatar.png" 
        />
        <div class="header-content">
            <a class="logo" href="/">Ethan-é€é“æ—¥è®°</a> 
            <span class="description">é€æœ‰é“æ— æœ¯ä¹‹é“</span> 
        </div>
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/tags/">æ ‡ç­¾</a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    ä¸€ã€Javaå¹¶å‘ç¼–ç¨‹-Javaå¹¶å‘åŒ…æºç 
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>æœ€è¿‘æ›´æ–°ï¼š2025-03-19</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>å­—æ•°æ€»è®¡ï¼š3.1k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š13åˆ†é’Ÿ</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
        
        <div class=".article-gallery"><h1 id="1-ThreadLocalRandomç±»åŸç†å‰–æ"><a href="#1-ThreadLocalRandomç±»åŸç†å‰–æ" class="headerlink" title="1. ThreadLocalRandomç±»åŸç†å‰–æ"></a>1. ThreadLocalRandomç±»åŸç†å‰–æ</h1><h2 id="1-1-Randomç±»åŠå…¶å±€é™æ€§"><a href="#1-1-Randomç±»åŠå…¶å±€é™æ€§" class="headerlink" title="1.1 Randomç±»åŠå…¶å±€é™æ€§"></a>1.1 Randomç±»åŠå…¶å±€é™æ€§</h2><p>åœ¨ Java ä¸­ï¼Œ<code>Random</code> ç±»ç”¨äºç”Ÿæˆä¼ªéšæœºæ•°ï¼Œå…¶æ ¸å¿ƒåŸç†æ˜¯åŸºäºç§å­ï¼ˆSeedï¼‰çš„è®¡ç®—ã€‚</p>
<h3 id="1-1-1-ä½¿ç”¨ç¤ºä¾‹"><a href="#1-1-1-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="1.1.1 ä½¿ç”¨ç¤ºä¾‹"></a>1.1.1 ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRandom</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// éšæœºè¾“å‡º10ä¸ª0~5ä¹‹é—´çš„éšæœºæ•°</span></span><br><span class="line">        System.out.println(random.nextInt(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ¯æ¬¡è°ƒç”¨ <code>nextInt()</code> éƒ½ä¼šåŸºäº <strong>å‰ä¸€æ¬¡çš„ç§å­å€¼</strong> è®¡ç®—æ–°çš„ç§å­ï¼Œä»è€Œç”Ÿæˆéšæœºæ•°ã€‚ç„¶è€Œï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œ<code>Random</code> å¯èƒ½ä¼šé‡åˆ°<strong>ç§å­ç«äº‰</strong>é—®é¢˜ï¼Œå¯¼è‡´ä¸åŒçº¿ç¨‹ç”Ÿæˆç›¸åŒçš„éšæœºæ•°ã€‚</p>
<h3 id="1-1-2-å·¥ä½œæœºåˆ¶"><a href="#1-1-2-å·¥ä½œæœºåˆ¶" class="headerlink" title="1.1.2  å·¥ä½œæœºåˆ¶"></a>1.1.2  å·¥ä½œæœºåˆ¶</h3><p><code>nextInt(int bound)</code> æ–¹æ³•çš„å®ç°é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">nextInt</span><span class="params">(<span class="type">int</span> bound)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. å‚æ•°æ ¡éªŒ</span></span><br><span class="line">    <span class="keyword">if</span> (bound &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(BadBound);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è®¡ç®—æ–°çš„ç§å­å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> next(<span class="number">31</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> bound - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è®¡ç®—éšæœºæ•°</span></span><br><span class="line">    <span class="keyword">if</span> ((bound &amp; m) == <span class="number">0</span>) &#123;  <span class="comment">// bound æ˜¯å¦ä¸º 2 çš„å¹‚</span></span><br><span class="line">        r = (<span class="type">int</span>) ((bound * (<span class="type">long</span>) r) &gt;&gt; <span class="number">31</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">int</span> u;</span><br><span class="line">        <span class="keyword">while</span> ((u = next(<span class="number">31</span>)) - (r = u % bound) + m &lt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ <strong>å•çº¿ç¨‹ç¯å¢ƒ</strong> ä¸‹ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ä¿è¯è¾ƒå¥½çš„éšæœºæ€§ã€‚ä½†æ˜¯åœ¨ <strong>å¤šçº¿ç¨‹ç¯å¢ƒ</strong> ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼š<strong>åŒæ—¶è¯»å–ç›¸åŒçš„ç§å­å€¼</strong>ï¼Œç„¶åæ‰§è¡Œæ­¥éª¤ 2 è®¡ç®—æ–°çš„ç§å­ï¼Œè¿™ä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹ç”Ÿæˆ<strong>ç›¸åŒçš„éšæœºæ•°</strong>ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJava é‡‡ç”¨ <strong>CASï¼ˆCompare And Swapï¼‰</strong> æœºåˆ¶æ¥ç¡®ä¿æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æˆåŠŸæ›´æ–°ç§å­ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»é‡æ–°è·å–æ–°çš„ç§å­åå†è®¡ç®—éšæœºæ•°ã€‚</p>
<h3 id="1-1-3-çº¿ç¨‹å®‰å…¨æ€§"><a href="#1-1-3-çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="1.1.3 çº¿ç¨‹å®‰å…¨æ€§"></a>1.1.3 çº¿ç¨‹å®‰å…¨æ€§</h3><p><code>Random</code> ä½¿ç”¨ <code>AtomicLong</code> å˜é‡å­˜å‚¨ç§å­ï¼Œå¹¶é€šè¿‡ <code>CAS</code> æ“ä½œä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„éšæœºæ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">next</span><span class="params">(<span class="type">int</span> bits)</span> &#123;</span><br><span class="line">    <span class="type">long</span> nextseed;</span><br><span class="line">    <span class="type">AtomicLong</span> <span class="variable">seed</span> <span class="operator">=</span> <span class="built_in">this</span>.seed;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// 1. è¯»å–å½“å‰ç§å­å€¼</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">oldseed</span> <span class="operator">=</span> seed.get();</span><br><span class="line">        <span class="comment">// 2. è®¡ç®—æ–°çš„ç§å­</span></span><br><span class="line">        nextseed = (oldseed * multiplier + addend) &amp; mask;</span><br><span class="line">        <span class="comment">// 3. CAS æ“ä½œæ›´æ–°ç§å­</span></span><br><span class="line">    &#125; <span class="keyword">while</span> (!seed.compareAndSet(oldseed, nextseed));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. ç”Ÿæˆéšæœºæ•°</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="type">int</span>) (nextseed &gt;&gt;&gt; (<span class="number">48</span> - bits));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼š</p>
<ol>
<li>çº¿ç¨‹ A è¯»å– <code>oldseed</code>ï¼Œè®¡ç®— <code>nextseed</code>ï¼Œå°è¯•æ›´æ–°ç§å­ã€‚</li>
<li>çº¿ç¨‹ B ä¹Ÿå¯èƒ½è¯»å–ç›¸åŒçš„ <code>oldseed</code>ï¼Œè®¡ç®— <code>nextseed</code>ï¼Œä½†åœ¨ <code>CAS</code> æ“ä½œæ—¶å¯èƒ½å¤±è´¥ã€‚</li>
<li>å¤±è´¥çš„çº¿ç¨‹ä¼šé‡æ–°è·å–æ–°çš„ <code>oldseed</code> å¹¶é‡æ–°è®¡ç®—ï¼Œç›´åˆ° <code>CAS</code> æ“ä½œæˆåŠŸã€‚</li>
</ol>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<code>Random</code> ç¡®ä¿äº†ç§å­çš„å”¯ä¸€æ€§ï¼Œä»è€Œé¿å…å¤šä¸ªçº¿ç¨‹ç”Ÿæˆç›¸åŒçš„éšæœºæ•°ã€‚</p>
<p>è™½ç„¶ <code>Random</code> ä½¿ç”¨äº† CAS æœºåˆ¶ï¼Œä½†åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä»ç„¶å¯èƒ½å¯¼è‡´<strong>å¤§é‡çº¿ç¨‹ç«äº‰åŒä¸€ä¸ªç§å­å˜é‡</strong>ï¼Œè‡ªæ—‹å½±å“æ€§èƒ½ã€‚</p>
<h2 id="1-2-ThreadLocalRandom"><a href="#1-2-ThreadLocalRandom" class="headerlink" title="1.2 ThreadLocalRandom"></a>1.2 ThreadLocalRandom</h2><p><code>ThreadLocalRandom</code> æ˜¯ Java 7 å¼•å…¥çš„ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆç±»ï¼Œä¸“é—¨ä¸ºå¤šçº¿ç¨‹ç¯å¢ƒè®¾è®¡ï¼Œå®ƒé€šè¿‡ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ç‹¬ç«‹çš„éšæœºæ•°ç”Ÿæˆå™¨æ¥é¿å…çº¿ç¨‹é—´çš„ç«äº‰ï¼Œä»è€Œæé«˜äº†åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹çš„æ€§èƒ½ã€‚</p>
<h3 id="1-2-1-ä½¿ç”¨ç¤ºä¾‹"><a href="#1-2-1-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="1.2.1 ä½¿ç”¨ç¤ºä¾‹"></a>1.2.1 ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testThreadLocalRandom</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// ç”Ÿæˆ 0~5 ä¹‹é—´çš„éšæœºæ•´æ•°</span></span><br><span class="line">        System.out.println(ThreadLocalRandom.current().nextInt(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ThreadLocalRandom.current()</code> è·å–å½“å‰çº¿ç¨‹çš„ <code>ThreadLocalRandom</code> å®ä¾‹ã€‚</p>
<p><code>nextInt(int bound)</code> ç”¨æ¥ç”Ÿæˆä¸€ä¸ªæŒ‡å®šèŒƒå›´çš„éšæœºæ•´æ•°ã€‚</p>
<h3 id="1-2-2-æºç è§£é‡Š"><a href="#1-2-2-æºç è§£é‡Š" class="headerlink" title="1.2.2 æºç è§£é‡Š"></a>1.2.2 æºç è§£é‡Š</h3><ol>
<li><p><code>ThreadLocalRandom.current()</code> æ–¹æ³•è§£æ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ThreadLocalRandom <span class="title function_">current</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (U.getInt(Thread.currentThread(), PROBE) == <span class="number">0</span>)</span><br><span class="line">        localInit();</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„å®ç°ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†ï¼š<strong><code>U.getInt()</code></strong> å’Œ <strong><code>localInit()</code></strong>ã€‚ä¸‹é¢æ˜¯å¯¹æ¯ä¸€éƒ¨åˆ†çš„è¯¦ç»†åˆ†æã€‚</p>
<ol>
<li><p>U.getInt(Thread.currentThread(), PROBE)</p>
<p><code>U.getInt()</code> æ˜¯ <code>sun.misc.Unsafe</code> ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºé€šè¿‡ <strong>Unsafe API</strong> è·å–çº¿ç¨‹çš„æŸä¸ªå­—æ®µçš„å€¼ã€‚åœ¨è¿™é‡Œï¼Œå®ƒè·å–å½“å‰çº¿ç¨‹çš„ <code>PROBE</code> å­—æ®µã€‚</p>
<ul>
<li><code>PROBE</code> æ˜¯ä¸€ä¸ªçº¿ç¨‹å±€éƒ¨å˜é‡ï¼ˆç”± <code>ThreadLocal</code> å®ç°ï¼‰ï¼Œç”¨æ¥è¡¨ç¤ºè¯¥çº¿ç¨‹çš„çŠ¶æ€ï¼Œé€šå¸¸å®ƒç”¨æ¥åšåˆå§‹åŒ–æ£€æŸ¥æˆ–æ ‡è®°ã€‚</li>
<li><strong><code>U.getInt(Thread.currentThread(), PROBE)</code></strong> è¿”å›å½“å‰çº¿ç¨‹çš„ <code>PROBE</code> å€¼ã€‚å¦‚æœå€¼ä¸º <code>0</code>ï¼Œè¯´æ˜è¯¥çº¿ç¨‹å°šæœªå®Œæˆåˆå§‹åŒ–ï¼Œå› æ­¤éœ€è¦è¿›è¡Œåˆå§‹åŒ–æ“ä½œã€‚</li>
</ul>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>å®ƒçš„ä½œç”¨æ˜¯æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡ <code>ThreadLocalRandom</code>ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰åˆå§‹åŒ–ï¼ˆ<code>PROBE == 0</code>ï¼‰ï¼Œåˆ™ä¼šè°ƒç”¨ <code>localInit()</code> æ¥è¿›è¡Œåˆå§‹åŒ–ã€‚</li>
</ul>
</li>
<li><p>localInit()</p>
<p><code>localInit()</code> æ˜¯ç”¨æ¥åˆå§‹åŒ–çº¿ç¨‹å±€éƒ¨éšæœºæ•°ç”Ÿæˆå™¨çš„å…³é”®æ–¹æ³•ï¼Œå®ƒä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…å”¯ä¸€çš„éšæœºç§å­å’Œæ ‡è¯†ç¬¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">localInit</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> probeGenerator.addAndGet(PROBE_INCREMENT);  <span class="comment">// è·å–ä¸‹ä¸€ä¸ª probe å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">probe</span> <span class="operator">=</span> (p == <span class="number">0</span>) ? <span class="number">1</span> : p; <span class="comment">// skip 0ï¼Œé¿å… probe å€¼ä¸º 0</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">seed</span> <span class="operator">=</span> mix64(seeder.getAndAdd(SEEDER_INCREMENT));  <span class="comment">// ç”Ÿæˆå¹¶è·å–æ–°çš„ç§å­</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    U.putLong(t, SEED, seed);  <span class="comment">// å°†ç§å­å€¼å­˜å‚¨åˆ°å½“å‰çº¿ç¨‹çš„ SEED å­—æ®µä¸­</span></span><br><span class="line">    U.putInt(t, PROBE, probe);  <span class="comment">// å°† probe å€¼å­˜å‚¨åˆ°å½“å‰çº¿ç¨‹çš„ PROBE å­—æ®µä¸­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p><code>next()</code> æ–¹æ³•</p>
<p>å½“è°ƒç”¨ <code>nextInt(bound)</code> æ–¹æ³•æ—¶ï¼Œ<code>ThreadLocalRandom</code> ä¼šåŸºäºå½“å‰çº¿ç¨‹çš„ç§å­ç”Ÿæˆä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„éšæœºæ•´æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">nextInt</span><span class="params">(<span class="type">int</span> bound)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. å‚æ•°æ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">if</span> (bound &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;bound must be positive&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç”Ÿæˆéšæœºæ•°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> mix32(nextSeed());</span><br><span class="line">    <span class="comment">// 3. ä¼˜åŒ–boundä¸º2çš„å¹‚æ¬¡æ–¹æ—¶çš„å¤„ç†</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> bound - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ((bound &amp; m) == <span class="number">0</span>)</span><br><span class="line">        r &amp;= m;</span><br><span class="line">    <span class="comment">// 4. å¤„ç†é2çš„å¹‚æ¬¡æ–¹æ—¶</span></span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="comment">// If not a power of two, reject over-represented candidates</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> r &gt;&gt;&gt; <span class="number">1</span>; u + m - (r = u % bound) &lt; <span class="number">0</span>; u = mix32(nextSeed()) &gt;&gt;&gt; <span class="number">1</span>)</span><br><span class="line">            ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>ç›¸å¯¹äºRandomç±»ä¼˜ç‚¹</strong></p>
<ul>
<li><strong>æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹çš„ç§å­</strong>ï¼šæ¯ä¸ªçº¿ç¨‹é€šè¿‡ <code>ThreadLocal</code> å­˜å‚¨è‡ªå·±çš„ç§å­ï¼Œé¿å…äº†çº¿ç¨‹ä¹‹é—´çš„ç«äº‰å’Œå†²çªã€‚ä¼ ç»Ÿçš„ <code>Random</code> ç±»åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå› ä¸ºå…±äº«ç§å­è€Œå¯¼è‡´å¤šä¸ªçº¿ç¨‹äº§ç”Ÿç›¸åŒçš„éšæœºæ•°ï¼Œè€Œ <code>ThreadLocalRandom</code> åˆ™æ¶ˆé™¤äº†è¿™ç§é—®é¢˜ã€‚</li>
<li><strong>é¿å…äº†é”ç«äº‰</strong>ï¼šä¼ ç»Ÿçš„ <code>Random</code> ç±»å¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œéœ€è¦åŒæ­¥æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯¼è‡´å¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼šåœ¨è®¿é—®æ—¶è‡ªæ—‹ç­‰å¾…ï¼ˆä¾‹å¦‚ï¼Œ<code>Random</code> é€šè¿‡ <code>synchronized</code> æ¥æ§åˆ¶å¯¹ç§å­çš„æ›´æ–°ï¼‰ã€‚è€Œ <code>ThreadLocalRandom</code> åˆ™é€šè¿‡ <code>ThreadLocal</code> ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ç‹¬ç«‹çš„ç§å­ï¼Œå› æ­¤é¿å…äº†è‡ªæ—‹ç­‰å¾…å’ŒåŒæ­¥å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</li>
<li><strong>æé«˜å¹¶å‘æ€§èƒ½</strong>ï¼šæ¯ä¸ªçº¿ç¨‹ä½¿ç”¨ç‹¬ç«‹çš„éšæœºæ•°ç§å­ï¼Œå¯ä»¥å¹¶è¡Œç”Ÿæˆéšæœºæ•°ï¼Œé¿å…äº†çº¿ç¨‹é—´çš„ç›¸äº’å¹²æ‰°å’Œé”ç«äº‰ï¼Œä»è€Œæé«˜äº†å¹¶å‘æ€§èƒ½ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œ<code>ThreadLocalRandom</code> çš„æ€§èƒ½æ¯”ä¼ ç»Ÿçš„ <code>Random</code> ç±»è¦å¥½å¾—å¤šã€‚</li>
<li><strong>ç§å­çš„åˆå§‹åŒ–</strong>ï¼š<code>ThreadLocalRandom</code> åœ¨æ¯ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ä¼šè‡ªåŠ¨åˆå§‹åŒ–ç§å­ï¼Œå¹¶å°†ç§å­ä¿å­˜åœ¨å½“å‰çº¿ç¨‹çš„æœ¬åœ°å˜é‡ä¸­ï¼Œè¿™æ ·åç»­çš„éšæœºæ•°ç”Ÿæˆéƒ½å¯ä»¥åŸºäºè¯¥çº¿ç¨‹è‡ªå·±çš„ç§å­è¿›è¡Œã€‚</li>
</ul>
<h1 id="2-åŸå­æ“ä½œç±»åŸç†è§£æ"><a href="#2-åŸå­æ“ä½œç±»åŸç†è§£æ" class="headerlink" title="2. åŸå­æ“ä½œç±»åŸç†è§£æ"></a>2. åŸå­æ“ä½œç±»åŸç†è§£æ</h1><p>åœ¨ Java çš„å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œ<code>java.util.concurrent.atomic</code> åŒ…æä¾›äº†ä¸€ç»„åŸºäº CASï¼ˆCompare-And-Swapï¼‰æ“ä½œçš„åŸå­ç±»ï¼Œå®ƒä»¬åœ¨æ— é”ç¯å¢ƒä¸‹ä¿è¯äº†çº¿ç¨‹å®‰å…¨æ€§ã€‚</p>
<h2 id="2-1-AtomicInteger-ä½¿ç”¨åŠæºç è§£æ"><a href="#2-1-AtomicInteger-ä½¿ç”¨åŠæºç è§£æ" class="headerlink" title="2.1 AtomicInteger ä½¿ç”¨åŠæºç è§£æ"></a>2.1 AtomicInteger ä½¿ç”¨åŠæºç è§£æ</h2><h3 id="2-1-1-ç”¨æ³•ä¸¾ä¾‹"><a href="#2-1-1-ç”¨æ³•ä¸¾ä¾‹" class="headerlink" title="2.1.1 ç”¨æ³•ä¸¾ä¾‹"></a>2.1.1 ç”¨æ³•ä¸¾ä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡æ„é€ å™¨èµ‹valueå€¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAtomicInteger</span> <span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º10ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œ1000æ¬¡è‡ªå¢</span></span><br><span class="line">    Thread[] threads = <span class="keyword">new</span> <span class="title class_">Thread</span>[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        threads[i] = <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++) &#123;</span><br><span class="line">                count.incrementAndGet(); <span class="comment">// çº¿ç¨‹å®‰å…¨çš„è‡ªå¢</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        threads[i].start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œ</span></span><br><span class="line">    <span class="keyword">for</span> (Thread thread : threads) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            thread.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºæœ€ç»ˆè®¡æ•°å€¼ï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯ 10000</span></span><br><span class="line">    System.out.println(<span class="string">&quot;æœ€ç»ˆè®¡æ•°å€¼: &quot;</span> + count.get());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-2-æºç è§£æ"><a href="#2-1-2-æºç è§£æ" class="headerlink" title="2.1.2 æºç è§£æ"></a>2.1.2 æºç è§£æ</h3><h4 id="2-1-2-1-æ ¸å¿ƒæˆå‘˜å˜é‡"><a href="#2-1-2-1-æ ¸å¿ƒæˆå‘˜å˜é‡" class="headerlink" title="2.1.2.1 æ ¸å¿ƒæˆå‘˜å˜é‡"></a>2.1.2.1 æ ¸å¿ƒæˆå‘˜å˜é‡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">U</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> VALUE;</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        VALUE = U.objectFieldOffset</span><br><span class="line">            (AtomicInteger.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicInteger</span><span class="params">(<span class="type">int</span> initialValue)</span> &#123;</span><br><span class="line">    value = initialValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è§£æ</strong></p>
<ul>
<li><p><code>U</code>ï¼šé€šè¿‡ <code>Unsafe</code> å®ç°åº•å±‚å†…å­˜æ“ä½œã€‚Unsafeç›´æ¥ä½¿ç”¨éœ€è¦åˆ¤æ–­è°ƒç”¨ç±»æ˜¯å¦ç”±<strong>Bootstrap ClassLoader</strong> åŠ è½½, è€Œ<code>AtomicInteger</code> åŠ <code>Unsafe</code> å±äº <code>java.base</code> æ¨¡å—ï¼Œè€Œ <code>java.base</code> é‡Œçš„ç±»æ˜¯ç”± <strong>å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰</strong> åŠ è½½çš„, æ‰€ä»¥æ­¤å¤„å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Unsafe <span class="title function_">getUnsafe</span><span class="params">()</span> &#123;</span><br><span class="line">    Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯ Bootstrap ClassLoader åŠ è½½</span></span><br><span class="line">    <span class="keyword">if</span> (!VM.isSystemDomainLoader(caller.getClassLoader()))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;Unsafe access denied&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> theUnsafe;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>value</code>ï¼šçœŸæ­£å­˜å‚¨æ•°æ®çš„ <code>volatile</code> å˜é‡ï¼Œä¿è¯å¯è§æ€§ã€‚åœ¨æ„é€ æ—¶å¯ä»¥èµ‹é»˜è®¤å€¼</p>
</li>
<li><p><code>VALUE</code>ï¼šè®°å½• <code>value</code> å­—æ®µåœ¨ <code>AtomicInteger</code> å¯¹è±¡å†…å­˜ä¸­çš„åç§»é‡ï¼Œä¾› <code>CAS</code> æ“ä½œä½¿ç”¨ã€‚</p>
</li>
</ul>
<h4 id="2-1-2-2-getAndIncrement"><a href="#2-1-2-2-getAndIncrement" class="headerlink" title="2.1.2.2  getAndIncrement()"></a>2.1.2.2  <code>getAndIncrement()</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> U.getAndAddInt(<span class="built_in">this</span>, VALUE, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@HotSpotIntrinsicCandidate</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAddInt</span><span class="params">(Object o, <span class="type">long</span> offset, <span class="type">int</span> delta)</span> &#123;</span><br><span class="line">    <span class="type">int</span> v;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      v = getIntVolatile(o, offset);</span><br><span class="line">    &#125; <span class="keyword">while</span> (!weakCompareAndSetInt(o, offset, v, v + delta));</span><br><span class="line">      <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è§£æ</strong></p>
<ul>
<li><p><code>Unsafe.getAndAddInt</code>:</p>
<ul>
<li>ä½¿ç”¨ <code>CAS</code> è¿›è¡ŒåŸå­åŠ æ³•ã€‚</li>
<li>ä¿è¯å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œæ—¶ï¼Œä¸ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ã€‚</li>
</ul>
</li>
<li><p><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š</p>
<p>é¿å… <code>synchronized</code> é€ æˆçš„çº¿ç¨‹é˜»å¡ï¼Œæé«˜æ•ˆç‡ã€‚</p>
</li>
<li><p><strong>ç¼ºç‚¹</strong></p>
<p>é«˜å¹¶å‘çš„åœºæ™¯ä¸‹, å¤šä¸ªçº¿ç¨‹ç«äº‰æ›´æ–°åŒä¸€ä¸ªåŸå­å˜é‡, åªæœ‰ä¸€ä¸ªçº¿ç¨‹CASä¼šæˆåŠŸ, å¤§é‡çº¿ç¨‹åœ¨ç«äº‰å¤±è´¥åä¼šè‡ªæ—‹å°è¯•CASæ“ä½œ, æµªè´¹æ€§èƒ½ã€‚</p>
</li>
</ul>
<h2 id="2-2-LongAdder-ä½¿ç”¨åŠæºç è§£æ"><a href="#2-2-LongAdder-ä½¿ç”¨åŠæºç è§£æ" class="headerlink" title="2.2 LongAdder ä½¿ç”¨åŠæºç è§£æ"></a>2.2 LongAdder ä½¿ç”¨åŠæºç è§£æ</h2><h3 id="2-2-1-ç”¨æ³•ä¸¾ä¾‹"><a href="#2-2-1-ç”¨æ³•ä¸¾ä¾‹" class="headerlink" title="2.2.1 ç”¨æ³•ä¸¾ä¾‹"></a>2.2.1 ç”¨æ³•ä¸¾ä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">LongAdder</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LongAdder</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLongAdder</span> <span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">threadCount</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">incrementsPerThread</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    Thread[] threads = <span class="keyword">new</span> <span class="title class_">Thread</span>[threadCount];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threadCount; i++) &#123;</span><br><span class="line">        threads[i] = <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; incrementsPerThread; j++) &#123;</span><br><span class="line">                counter.increment(); <span class="comment">// çº¿ç¨‹å®‰å…¨çš„è‡ªå¢</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        threads[i].start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">    <span class="keyword">for</span> (Thread thread : threads) &#123;</span><br><span class="line">        thread.join();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æœ€ç»ˆç»“æœ</span></span><br><span class="line">    System.out.println(<span class="string">&quot;æœ€ç»ˆè®¡æ•°å€¼: &quot;</span> + counter.sum()); <span class="comment">// é¢„æœŸæ˜¯ 10000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-æºç è§£æ"><a href="#2-2-2-æºç è§£æ" class="headerlink" title="2.2.2 æºç è§£æ"></a>2.2.2 æºç è§£æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LongAdder</span> <span class="keyword">extends</span> <span class="title class_">Striped64</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»´æŠ¤çš„åŸºç¡€å€¼ï¼Œåœ¨ä½å¹¶å‘æ—¶ç›´æ¥æ›´æ–°</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="type">long</span> base;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»´æŠ¤çš„ Cell æ•°ç»„ï¼Œåœ¨é«˜å¹¶å‘æ—¶ç”¨äºåˆ†æ•£ç«äº‰</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> Cell[] cells;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç´¯åŠ æŒ‡å®šå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">long</span> x)</span> &#123;</span><br><span class="line">        Cell[] cs; <span class="type">long</span> b, v; <span class="type">int</span> m; Cell c;</span><br><span class="line">        <span class="comment">// å°è¯•ç›´æ¥æ›´æ–° base å˜é‡ï¼Œå¤±è´¥ï¼ˆé«˜å¹¶å‘æˆ–å·²ç»åˆå§‹åŒ– cells[]ï¼‰åˆ™è¿›å…¥ç»†ç²’åº¦å¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> ((cs = cells) != <span class="literal">null</span> || !casBase(b = base, b + x)) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">uncontended</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (cs == <span class="literal">null</span> || (m = cs.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">                (c = cs[getProbe() &amp; m]) == <span class="literal">null</span> ||</span><br><span class="line">                !(uncontended = c.cas(v = c.value, v + x))) &#123;</span><br><span class="line">                <span class="comment">// è¿›å…¥ longAccumulate æ–¹æ³•ï¼Œè¿›ä¸€æ­¥å¤„ç†å†²çªæˆ–æ‰©å®¹ cells[]</span></span><br><span class="line">                longAccumulate(x, <span class="literal">null</span>, uncontended);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å¢ 1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        add(<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å‡ 1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">        add(-<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¡ç®—å½“å‰æ€»å’Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">sum</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] cs = cells;</span><br><span class="line">        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> base;</span><br><span class="line">        <span class="keyword">if</span> (cs != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cell c : cs) &#123;</span><br><span class="line">                <span class="keyword">if</span> (c != <span class="literal">null</span>) sum += c.value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Cell ç±»ï¼šç”¨äºå­˜å‚¨åˆ†æ®µè®¡æ•°å€¼ï¼Œç»§æ‰¿ AtomicLong å¹¶æ·»åŠ ç¼“å­˜å¡«å……</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@sun</span>.misc.Contended</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Cell</span> &#123;</span><br><span class="line">        <span class="keyword">volatile</span> <span class="type">long</span> value;</span><br><span class="line"></span><br><span class="line">        Cell(<span class="type">long</span> x) &#123;</span><br><span class="line">            value = x;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="title function_">cas</span><span class="params">(<span class="type">long</span> cmp, <span class="type">long</span> val)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> UNSAFE.compareAndSwapLong(<span class="built_in">this</span>, valueOffset, cmp, val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.Unsafe UNSAFE;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                UNSAFE = sun.misc.Unsafe.getUnsafe();</span><br><span class="line">                valueOffset = UNSAFE.objectFieldOffset(Cell.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><h3 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a><strong>è§£æ</strong></h3><ol>
<li><p><strong>ä½å¹¶å‘æ—¶çš„ä¼˜åŒ–</strong></p>
<p>åœ¨ <strong>ä½å¹¶å‘</strong> æƒ…å†µä¸‹ï¼Œ<code>LongAdder</code> ç›´æ¥ä½¿ç”¨ <code>base</code> å˜é‡è¿›è¡Œ <code>CAS</code>ï¼ˆæ— é”åŸå­æ“ä½œï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((cs = cells) != <span class="literal">null</span> || !casBase(b = base, b + x)) &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>cells == null</code>ï¼šè¡¨ç¤ºå½“å‰ç«äº‰è¾ƒå°‘ï¼Œè¿˜æœªå¯ç”¨ <code>cells[]</code> æœºåˆ¶ã€‚</li>
<li><code>casBase(b = base, b + x)</code>ï¼šå°è¯•ç›´æ¥æ›´æ–° <code>base</code>ï¼Œå¦‚æœæˆåŠŸï¼Œè¯´æ˜æ— ç«äº‰ï¼Œç›´æ¥è¿”å›ã€‚</li>
</ul>
<p><strong>ä½å¹¶å‘æ—¶ï¼Œ<code>LongAdder</code> é‡‡ç”¨ <code>AtomicLong</code> ç±»ä¼¼çš„ <code>CAS</code> æœºåˆ¶ï¼Œé¿å…ä¸å¿…è¦çš„å¤æ‚æ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚</strong></p>
</li>
<li><p><strong>é«˜å¹¶å‘æ—¶çš„ä¼˜åŒ–</strong></p>
<p>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–° <code>LongAdder</code>ï¼Œç›´æ¥æ“ä½œ <code>base</code> ä¼šå¯¼è‡´ <code>CAS</code> å¤±è´¥ï¼Œè§¦å‘ <code>cells[]</code> æœºåˆ¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (cs == <span class="literal">null</span> || (m = cs.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">    (c = cs[getProbe() &amp; m]) == <span class="literal">null</span> ||</span><br><span class="line">    !(uncontended = c.cas(v = c.value, v + x))) &#123;</span><br><span class="line">    longAccumulate(x, <span class="literal">null</span>, uncontended);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å…·ä½“ä¼˜åŒ–ç‚¹ï¼š</strong></p>
<ol>
<li><strong>çº¿ç¨‹å“ˆå¸Œæ˜ å°„</strong><ul>
<li><code>c = cs[getProbe() &amp; m]</code>ï¼šæ¯ä¸ªçº¿ç¨‹é€šè¿‡ <code>getProbe()</code> è®¡ç®—ç´¢å¼•ï¼Œè®¿é—® <code>cells[]</code> æ•°ç»„çš„æŸä¸ª <code>Cell</code>ï¼Œå‡å°‘çƒ­ç‚¹ç«äº‰ã€‚</li>
</ul>
</li>
<li><strong><code>Cell</code> æœºåˆ¶</strong><ul>
<li><code>Cell</code> ç±»ç±»ä¼¼ <code>AtomicLong</code>ï¼Œä½†å¢åŠ  <code>@sun.misc.Contended</code> æ³¨è§£ï¼Œé˜²æ­¢ <strong>ä¼ªå…±äº«</strong>ï¼ˆå¤šä¸ª <code>Cell</code> å…±äº«åŒä¸€ç¼“å­˜è¡Œå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>å¤±è´¥é‡è¯•æœºåˆ¶</strong><ul>
<li><code>c.cas(v = c.value, v + x)</code> å¤±è´¥æ—¶ï¼Œä¼šè¿›å…¥ <code>longAccumulate()</code> è¿›è¡Œ <strong>é‡æ–°æ¢æµ‹æˆ–æ‰©å®¹</strong>ã€‚</li>
</ul>
</li>
</ol>
<p><strong>é«˜å¹¶å‘æ—¶ï¼Œ<code>LongAdder</code> é‡‡ç”¨ <code>cells[]</code> è¿›è¡Œåˆ†æ®µç´¯åŠ ï¼Œé¿å… <code>CAS</code> å¤±è´¥é€ æˆçš„é¢‘ç¹é‡è¯•ã€‚</strong></p>
</li>
<li><p><code>cells[]</code> çš„æ‰©å®¹æœºåˆ¶</p>
<p>å½“ <code>cells[]</code> ç«äº‰ä»ç„¶æ¿€çƒˆï¼ˆå³ <code>Cell.cas()</code> å¤±è´¥å¤šæ¬¡ï¼‰ï¼Œä¼šè¿›è¡Œæ‰©å®¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (cells.length &lt; NCPU) &#123;</span><br><span class="line">    expandCells();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>cells[]</code> <strong>åˆå§‹åŒ–æ—¶å¤§å°ä¸º 2</strong>ï¼Œéšç€å†²çªå¢åŠ ï¼Œ<code>cells[]</code> ä¼š <strong>æŒ‰ 2 çš„æŒ‡æ•°å¢é•¿</strong>ï¼Œç›´åˆ° <code>NCPU</code>ï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰ã€‚</li>
<li><strong>æ‰©å®¹åï¼Œçº¿ç¨‹ä¼šé‡æ–°åˆ†å¸ƒåˆ°æ–°çš„ <code>Cell</code>ï¼Œå‡å°‘ç«äº‰ã€‚</strong></li>
</ul>
<p> <strong><code>cells[]</code> é‡‡ç”¨æ‡’åŠ è½½ + è‡ªé€‚åº”æ‰©å®¹ï¼Œå‡å°‘å†…å­˜å¼€é”€ï¼Œæé«˜ååé‡ã€‚</strong></p>
</li>
</ol>
</li>
</ul>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-04-15</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« Ethan</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/Java/'>
                            Java
                        </a>
                    
                        <a href='/tags/JUC/'>
                            JUC
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/JUC/'>
                            JUC
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/2023/04/10/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_02/">äºŒã€Javaå¹¶å‘ç¼–ç¨‹-å¹¶å‘åŸºç¡€</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2025 China 

            
                

            
                
                    / <a href="/contact/"> è”ç³» </a>
                

            
                
                    / <a href="/support/"> æ”¯æŒ </a>
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>âœ¨&#34;The only way to achieve the impossible is to believe it is possible.&#34; âœ¨</span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>